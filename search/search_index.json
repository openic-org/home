{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to Docs.OpenIC","text":"<p>OpenIC is a new organization focusing on Research &amp; Development (R&amp;D) of Integrated Circuits (ICs) and surrounding electronics using Open-Source Electronic Design Automation (EDA) tools. We aim to work closely with Universities, Research Institutions, and Industry, especially with small organizations, startups, and academic labs, to provide them with custom ICs at a low cost.</p>"},{"location":"#projects","title":"Projects","text":"<ul> <li> <p> Iris 128</p> <p>128-Channel Intan-based headstages.</p> </li> <li> <p> ASICs</p> <p>Coming soon.</p> </li> </ul>"},{"location":"#contact","title":"Contact","text":"<ul> <li>For all inquiries, please contact info@openic.org</li> </ul>"},{"location":"iris-128/","title":"Iris-128","text":"<p>Open-source 128-channel headstages for neural stimulation and recording.</p> <p>The publication of this work can be found at DOI 10.1088/1741-2552/ae1876. The raw data files corresponding to the publication can be found at https://doi.org/10.17605/OSF.IO/XS2PU.</p> <p></p> Type Description Iris-128B Fully bidirectional headstage with recording or stimulation across all 128 electrode channels. Iris-128S Selective stimulation headstage with recording from 128 channels and stimulation on 16 simultaneous channels out of 32 available stimulation channels. Thin-film electrode 128 channel surface array used as a test platform for the headstages."},{"location":"iris-128/#eda-tools-used-in-the-development","title":"EDA Tools used in the Development","text":"EDA Tool Version Usage KiCad 8.0.5 Design of PCBs. KiCad 9.0.3 Design of PCBs. STM32CubeIDE 1.16.0 Design of firmware for MCU."},{"location":"iris-128/#developers","title":"Developers","text":"<ul> <li> Deku Lab, University of Oregon, Eugene, OR</li> <li> OpenIC, Eagan, MN</li> </ul>"},{"location":"iris-128/#license","title":"License","text":"<p>Copyright 2025 Manuel Monge, Emma Jacobs</p> <p>Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p> <p>http://www.apache.org/licenses/LICENSE-2.0</p> <p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>"},{"location":"iris-128/iris-128b/","title":"Iris-128B","text":"<p>Fig. 1. Iris-128B Neural Interface.</p> <p>The left labels the cables and components needed for the system, in addition to the Intan RHS controller and electrodes. Fig. 1 shows the front of Iris 128B with a SEARAY 160 pin connector, four RHS2000 ICs, an 80-pin Molex connector, pinouts, decoupling capacitors, and terminating resistors. Mounting holes are M2. The back of Iris 128B with four RHS2000 ICs.</p>"},{"location":"iris-128/iris-128b/#description","title":"Description","text":""},{"location":"iris-128/iris-128b/#components","title":"Components","text":"<p>The descriptions of each part of the system can be found below, along with a quick start guide.</p> Component Page Headstage Headstage Adapter Adapter Quick start guide Quick start guide"},{"location":"iris-128/iris-128b/#overview","title":"Overview","text":"<p>A 128-channel neural interface capable of stimulation and recording.</p> <p>This project develops a system that can stimulate and record from 128 channels using commercially available ICs and integrates into existing commercially available controllers (Intan RHS system). This can be used for small animal, anesthetized electrophysiology, non-human primates, or could be applied to clinical, intraoperative human use cases.</p>"},{"location":"iris-128/iris-128b/#iris-128b-architecture","title":"Iris 128B Architecture","text":"<p>The Iris 128B system consists of 2 boards: the headstage and the adapter.</p> <ul> <li>The headstage is a small electronic system placed on top of or near the electrophysiological signals being recorded.</li> <li>It uses commercially available off-the-shelf components.</li> <li>The adapter board receives signals from the headstage (through the 80 pin nanopitch Molex connector and cable) and breaks them out into cables that interface with the Intan Rec/Stim Controller.</li> </ul> <p></p> <p>Fig. 2. System architecture.</p> <p></p>"},{"location":"iris-128/iris-128b/#specifications","title":"Specifications","text":"<ul> <li>Recording and stimulation from all 128 channels.</li> <li>Compatible with Intan Recording Controller and Intan Stim/Record Controller.</li> <li>SEAM8 Samtec connector for interfacing with 128-ch electrode array and compatible with BlackRock Cereplex E headstages.</li> <li>The headstage has a size of 27 x 44 mm\\(^2\\).</li> <li>Molex Nanopitch 76-POS connector to interface with Adapter board through a single cable.</li> <li>Adapter board draws power from power supply.</li> <li>The adapter has a size of 57 x 58 mm\\(^2\\).</li> </ul>"},{"location":"iris-128/iris-128b/adapter_iris128B/","title":"Adapter","text":"<p>Fig. 1. Adapter connections.</p> <p>The Iris 128B system consists of 2 boards: the headstage and the adapter.</p> <ul> <li>The adapter board receives signals from the headstage (through the 80 pin nanopitch Molex connector and cable) and breaks them out into cables that interface with the Intan Rec/Stim Controller.</li> </ul> <p>This is a board with no active components on it. It's purpose is simply to route the connections from the Iris-128B headstage to the power supply, and the four ports on the Intan RHS controller. It also has some header pins intended for testing the SPI connections.</p>"},{"location":"iris-128/iris-128b/adapter_iris128B/#specifications","title":"Specifications","text":"<p>This is a 4 layer board that only routes digital signals. It takes the signals from the headstages and breaks them out into the appropriate connector for the RHS intan controller (interfacing with PZN 18 pin omnetics cables).</p> <p></p> <p>Fig. 2. Omnetics output from adapter board. This is repeated 4 times. Each connector routes two chips into the ports on each controller.</p>"},{"location":"iris-128/iris-128b/adapter_iris128B/#table-1-pcb-specifications","title":"Table 1. PCB Specifications","text":"PCB Specification Value Size 27 \u00d7 44 mm\u00b2 Trace Width / Space 3 mil / 3 mil Layers 8 Thru-Hole Via (Hole / Diameter) 8 mil / 14 mil Microvia (Hole / Diameter) 6 mil / 12 mil Thickness 0.039 in (1 mm) Surface Finish ENIG Copper Weight 1 oz"},{"location":"iris-128/iris-128b/adapter_iris128B/#table-2-adapter-components","title":"Table 2. Adapter components","text":"Component Part Manufacturer Description J1 SEAM8-20-S02.0-S-08-3 Samtec 160-pin connector to electrode sites. S1-S4 Omnetics A79633 PZN-16-AA Intan Intan VSTIM-, VSTIM+, VCC CP-063AH-ND  Pwr Jack Molex Barrel jack inputs for the power supplies."},{"location":"iris-128/iris-128b/headstage_iris128B/","title":"Headstage","text":"<p> Fig. 1. Schematic of Iris 128B.</p> <p>The Iris 128B system consists of 2 boards: the headstage and the adapter.</p> <ul> <li>The headstage is a small electronic system placed on top of or near the electrophysiological signals being recorded.</li> <li>It uses commercially available off-the-shelf components.</li> </ul>"},{"location":"iris-128/iris-128b/headstage_iris128B/#fabrication-notes","title":"Fabrication Notes","text":"<p>The cable used to connect the headstage to the adapter board is Molex 8X STR NPIO/ 8X STR NPIO 2PC LATCH 34A, #205058-1002. This cable is no longer manufactured. However, the connector is still available. We are working on alternatives - and a smaller version of these headstages. Feel free to contact us (fdeku@uoregon.edu or manuel@openic.org) if you would like to use this design and want to discuss alternative options. </p> <p>If you are able to use the Molex nanopitch cables, please note:</p> <ul> <li>In this design, pins Chip 5 \u2013 MOSI+ and Chip 5 \u2013 MOSI\u2013 connect to unused pins on the cable (A20 and A21). To address this we modified the cable by adding wires to it after it was ordered.</li> </ul>"},{"location":"iris-128/iris-128b/headstage_iris128B/#headstage-cost-breakdown","title":"Headstage Cost Breakdown","text":"<ul> <li>8 \u00d7 $392 \u2014 RHS2116 chips  </li> <li>1 \u00d7 $24 \u2014 SEAM8-20-S02.0-S-08-3 connector  </li> <li>1 \u00d7 $67 \u2014 NPIO / 8X STR NPIO 2PC LATCH 34A cable (DISCONTINUED AS OF AUG. 2025) </li> <li>1 \u00d7 $11 \u2014 CONN NANO-PITCH I/O RCPT 80P RA connector  </li> <li>$125 \u2014 1 headstage printed circuit board  </li> <li>$60 \u2014 1 adapter printed circuit board  </li> <li>4 \u00d7 $265 \u2014 RHS interface cables  </li> </ul>"},{"location":"iris-128/iris-128b/headstage_iris128B/#estimated-total-costs","title":"Estimated Total Costs","text":"<ul> <li>\u2248 $3,356 \u2014 Headstage  </li> <li>\u2248 $1,325 \u2014 Cabling</li> </ul>"},{"location":"iris-128/iris-128b/headstage_iris128B/#components","title":"Components","text":"Component Part Manufacturer Description J1 SEAM8-20-S02.0-S-08-3 Samtec 160-pin connector to electrode sites. U1\u2013U8 RHS2116 Intan Stimulation &amp; recording chip. J2 CONN NANO-PITCH I/O RCPT 80P RA, #1731620131 Molex 80-pin connector that routes the digital signals from the headstage to the adapter board."},{"location":"iris-128/iris-128b/headstage_iris128B/#specifications","title":"Specifications","text":""},{"location":"iris-128/iris-128b/headstage_iris128B/#electrode128","title":"Electrode128","text":"<p>This is the output/input that interfaces with the electrophysiological signals.</p> <p>We are currently using the SEAM8 Samtec connector for interfacing with a 128-ch electrode array. The footprint on the headstage is shown below.</p> <p>The left and right two rows are dedicated for GND and REF connectors. The remaining 16\u00d78 are for connecting to the 128 electrodes. All the GND for the chips, power supplies, and thin-film are shared.</p> <p>This is the same footprint/connector used with BlackRock Cereplex E headstages, maintaining compatibility with interchangeable thin-film interfaces.</p> <p></p> <p>Fig. 2. Footprint of SEAM 160 (8x20) pin connector. Outer two rows are reserved for reference and gnd. The 3.3V and LED are unconnected. The locations of these gnd and reference pins are meant to match the Cereplex E headstages. We have used thin-films interchangeably between the two systems so we have preserved that footprint in this version of the headstage. The footprint is labeled C#, indicating the chip it routes to, and E# indicating the electrode.</p>"},{"location":"iris-128/iris-128b/headstage_iris128B/#chip1-through-chip8","title":"Chip1 through Chip8","text":"<p>These are RHS2116 chips (QFN package) from Intan Technologies. There are 8 total chips (16 electrodes each) communicating with the controller via SPI (Serial Peripheral Interface). </p> <p></p> <p>Fig. 3. Footprint of RHS2116 on Iris128B with broadly labeled pins. See the Intan RHS2116 datasheet for specific details.</p> <p>The reference and ground pins can be shorted or disconnected using the pads shown below.</p> <p></p> <p>Fig. 4. Footprint location of pads to short ref and gnd. Also seen here are the plated through holes on the left where gnd and ref wires can be soldered.</p> <p>Digital (SPI) communication lines to each of the 8 chips:</p> <ul> <li>Chip Select (CS)</li> <li>Serial Clock (SCLK)</li> <li>Serial Data Input (MOSI)</li> <li>Serial Data Output (MISO)</li> </ul> <p>Because LVDS (Low-Voltage Differential Signaling) is used to decrease noise sensitivity, each line type has a + and \u2013 pair:</p> <ul> <li>CS+, CS\u2013</li> <li>SCLK+, SCLK\u2013</li> <li>MOSI+, MOSI\u2013</li> <li>MISO+, MISO\u2013</li> </ul> <p>LVDS transmits low-voltage paired differential signals, reducing electromagnetic interference (EMI).</p> <p>Power requirements:</p> <ul> <li>\u00b13.3V to \u00b17V for stimulation</li> <li>3.3V for digital logic and analog power</li> <li>~50 mW consumption (RHS2116, 16 channels recording)</li> </ul> <p>For comparison:</p> <ul> <li>RHD2164: 3.3V single supply, no stimulation, ~75 mW for 64 channels.</li> </ul> <p></p> <p>Fig. 5. Footprint of Molex 80 pin connector on Iris128B with broadly labeled pins. Any unlabled pins are digital communication lines to the chips. Not the x for NC pins due to the commericially available cable assembly.</p> <p>SPI lines are routed through the adapter board to the Intan RHS controller ports A\u2013D. SCLK and CS lines are shared between all chips, while data input/output lines are individually connected.</p>"},{"location":"iris-128/iris-128b/headstage_iris128B/#layers","title":"Layers","text":""},{"location":"iris-128/iris-128b/headstage_iris128B/#table-1-pcb-specifications","title":"Table 1. PCB Specifications","text":"PCB Specification Value Size 27 \u00d7 44 mm\u00b2 Trace Width / Space 3 mil / 3 mil Layers 8 Thru-Hole Via (Hole / Diameter) 8 mil / 14 mil Microvia (Hole / Diameter) 6 mil / 12 mil Thickness 0.039 in (1 mm) Surface Finish ENIG Copper Weight 1 oz"},{"location":"iris-128/iris-128b/headstage_iris128B/#table-5-headstage-pcb-stack-up","title":"Table 5. Headstage PCB Stack Up","text":"Layer Notes 1 Minimal local routing + GND plane Prepreg 2 Supplies + SPI + some electrode signal routing + GND plane Core 3 GND plane Prepreg 4 Signal routing + some supply traces + GND plane Core 5 Signal routing + GND plane Prepreg 6 Signal routing + GND plane Core 7 GND plane + SPI routing Prepreg 8 Minimal local routing + GND plane"},{"location":"iris-128/iris-128b/quickstart_iris128B/","title":"Iris-128B Quickstart Guide","text":"<p>Info</p> <p>Open-Source 128-Channel Headstage for Neural Recording and Stimulation (Based on Jacobs et al., 2025 \u2013 \u201cIris 128x: Open-Source 128-Channel Headstages for Neural Stimulation and Recording\u201d)</p>"},{"location":"iris-128/iris-128b/quickstart_iris128B/#1-system-overview","title":"1. System Overview","text":"<p>The Iris-128B system provides 128-channel, fully bidirectional recording and stimulation capability using eight Intan RHS2116 integrated amplifier/stimulator chips. It interfaces with thin-film microelectrode arrays through a Samtec SEAF8-20-1-S-08-2-RA connector and communicates with an Intan RHS Controller via low-voltage differential signaling (LVDS) through a Molex 80-pin nanopitch cable and an adapter board.</p>"},{"location":"iris-128/iris-128b/quickstart_iris128B/#2-power-supply-requirements","title":"2. Power Supply Requirements","text":"<p>Use a bench DC power supply such as the HP E3631A Triple Output DC Power Supply (HP Inc., Palo Alto, CA).  </p> Rail Voltage Current Limit Description Vstim + +7 V 100 mA Positive stimulation rail Vstim \u2013 \u20137 V 100 mA Negative stimulation rail VCC +3.3 V 100 mA Digital logic &amp; analog power <p>Tip: Keep each supply current-limited to 100 mA to protect the headstage.</p> <p></p> <p>Fig. 1. Wiring diagram containing power supplies, intan controller, adapter board, and cable to headstage.</p>"},{"location":"iris-128/iris-128b/quickstart_iris128B/#3-hardware-components","title":"3. Hardware Components","text":"<ul> <li> <p>Headstage (Iris-128B) </p> <ul> <li>8 \u00d7 Intan RHS2116 ICs (recording + stimulation)</li> <li>Samtec SEAF8 connector (160-pin) for thin-film MEA</li> <li>Molex 80-pin nanopitch output to adapter</li> <li>\u00b13.3 \u2013 7 V supply range  </li> </ul> </li> <li> <p>Adapter Board</p> <ul> <li>Passive signal routing (no active components)  </li> <li>4 \u00d7 Omnetics A79633 connectors to Intan RHS ports A\u2013D  </li> <li>3 \u00d7 barrel jacks for \u00b1Vstim and VCC  </li> </ul> </li> </ul>"},{"location":"iris-128/iris-128b/quickstart_iris128B/#4-hardware-setup","title":"4. Hardware Setup","text":""},{"location":"iris-128/iris-128b/quickstart_iris128B/#step-1-prepare-for-surgery","title":"Step 1 \u2014 Prepare for Surgery","text":"<ol> <li>Secure the animal in a stereotaxic frame.  </li> <li>Mount the 3D-printed headstage holder onto the stereotax.  </li> <li>Seat the thin-film electrode connector into the holder.  </li> <li>Plug the Iris-128B headstage into the thin-film connector.  </li> <li>Fasten the headstage to the holder via mounting holes.</li> </ol> <p>Fig. 2. (A) Headstage with thinfilm attached to stereotax in 3d printed fixture. (B) Headstage and thinfilm.</p>"},{"location":"iris-128/iris-128b/quickstart_iris128B/#step-2-connect-to-adapter","title":"Step 2 \u2014 Connect to Adapter","text":"<ol> <li>Connect the Molex 80-pin cable between headstage and adapter.</li> <li>Route this cable outside the Faraday cage.</li> <li>Plug in the 4 RHS interface cables (red Omnetics):<ul> <li>S1 \u2192 Port A (shared CLK and CS)  </li> <li>S2 \u2192 Port B </li> <li>S3 \u2192 Port C </li> <li>S4 \u2192 Port D</li> </ul> </li> </ol>"},{"location":"iris-128/iris-128b/quickstart_iris128B/#step-3-ground-and-reference","title":"Step 3 \u2014 Ground and Reference","text":"<ul> <li>Connect REF and GND pads using platinum wires soldered into the through-holes on the headstage.  </li> <li>Keep REF and GND unshorted during normal operation.  </li> <li>Optionally, these may be tied together or implemented on the thin-film array.  </li> <li>Ensure the entire setup (animal, cage, supplies) shares a common ground.</li> </ul>"},{"location":"iris-128/iris-128b/quickstart_iris128B/#5-software-setup","title":"5. Software Setup","text":"<ol> <li>Install Intan RHS Recording Controller Software (see Intan User Guide).  </li> <li>Connect the RHS Controller to the computer via USB.    </li> </ol>"},{"location":"iris-128/iris-128b/quickstart_iris128B/#6-power-up-sequence","title":"6. Power-Up Sequence","text":"<ol> <li>Confirm the Intan controller and power supplies are connected to the chassis ground on the controller (green plug on back of controller) and the grounds on the power supply are all connected to each other as well. </li> <li>Set voltages on the HP E3631A:<ul> <li>+7 V, \u20137 V, +3.3 V rails  </li> <li>100 mA current limits  </li> </ul> </li> <li>Plug barrel jacks into Vstim\u00b1 and VCC inputs on the adapter.  </li> <li>Turn on the power supply. </li> <li>Turn on the Intan Controller.</li> <li>Launch the software \u2014 channels from Ports A\u2013D should automatically appear.  </li> <li>Adjust sampling rate and channel naming as needed.</li> </ol> <p>Fig. 3. Software launch with 4 connected ports (total 128 channels).</p>"},{"location":"iris-128/iris-128b/quickstart_iris128B/#7-bench-animal-setup-checklist","title":"7. Bench &amp; Animal Setup Checklist","text":"Stage Procedure Bench Validation Connect planar 128-ch polyimide MEA \u2192 verify impedance in PBS (~295 k\u03a9 @ 1 kHz). Grounding Attach platinum wires for REF and GND to headstage pads. Recording Launch Intan software \u2192 set sampling rate 30 kSa/s \u2192 confirm signal. In Vivo Setup Craniotomy \u2192 insert MEA into cortex \u2192 connect headstage. Validation Observe LFPs (0.5\u2013100 Hz) and single-unit spikes (~250\u2013500 \u00b5Vpp)."},{"location":"iris-128/iris-128b/quickstart_iris128B/#8-performance-summary","title":"8. Performance Summary","text":"Metric Iris 128B Comparison (Intan 32 ch) Noise (Vrms) 3.09 \u00b5V 2.4 \u00b5V Weight 9.6 g 1.4 g Volume 1188 mm\u00b3 576 mm\u00b3 Channels 128 stim / 128 record 32 stim / 32 record Frequency Response 0.5 Hz \u2013 5 kHz (flat midband gain) Similar Impedance (1 kHz, Pt site) ~2.9 \u00d7 10\u2075 \u03a9 2.4 \u00d7 10\u2075 \u03a9 Supply \u00b17 V &amp; 3.3 V 3.3 V (single)"},{"location":"iris-128/iris-128b/quickstart_iris128B/#9-stimulation-parameters","title":"9. Stimulation Parameters","text":"<ul> <li>Chip: Intan RHS2116 (D5716)  </li> <li>Current Range: 2.55 \u00b5A \u2013 255 \u00b5A  </li> <li>Step Size: 10 nA \u2013 10 \u00b5A  </li> <li>Supply Range: \u00b13.3 \u2013 10.7 V (max combined 14 V)  </li> <li>Sampling Rates: 1 \u2013 30 kS/s  </li> <li>Test Waveform: Biphasic cathodic-first 4 \u00b5A, 500 \u00b5s pulses, 100 Hz (0.1 mC/cm\u00b2 charge density)</li> </ul>"},{"location":"iris-128/iris-128b/quickstart_iris128B/#10-additional-notes","title":"10. Additional Notes","text":"<ul> <li>The Molex #205058-1002 cable assembly is discontinued; contact fdeku@uoregon.edu or manuel@openic.org for updated options.</li> <li>The design files, schematics, and BOMs are open-source on GitHub (OpenIC / U Oregon).  </li> <li>The Iris 128B and 128S share identical PCB stack-up and fabrication parameters:<ul> <li>8-layer (3 mil trace / space, ENIG finish, 1 oz Cu).  </li> </ul> </li> <li>Designed in KiCad, verified by micro-CT imaging and in vivo electrophysiology recordings.  </li> <li>For portable or wireless operation, future iterations aim to reduce weight &lt; 5 g and integrate on-board power management.</li> </ul>"},{"location":"iris-128/iris-128b/quickstart_iris128B/#11-reference-setup-recipe","title":"11. Reference Setup Recipe","text":"<ol> <li>Power on HP E3631A (\u00b17 V &amp; 3.3 V outputs).  </li> <li>Connect thin-film \u2192 headstage \u2192 adapter \u2192 Intan Controller.  </li> <li>Verify REF/GND connections (platinum wire \u2192 bone screws).  </li> <li>Enable power and confirm communication in Intan software.  </li> <li>Begin recording and stimulation tests.</li> </ol>"},{"location":"iris-128/iris-128s/","title":"Iris-128S","text":"<p>Figure 1. Iris-128S Neural Interface.</p>"},{"location":"iris-128/iris-128s/#description","title":"Description","text":"<p>The Iris-128S neural interface consists of 2 boards: the headstage and the adapter. The headstage is a small electronic board that is normally placed on top of or nearby the animal model being studied. It has been designed to be as small as possible while using standard, commercially available off-the-shelf components. The adapter is a small electronic board which has been designed to interface with the Intan Recording Controller, the Intan Rec/Stim Controller, and a programmer/computer to program the switches in the headstage via a MCU.</p> <p>The architecture and schematic of Iris-128S are shown in the figures below.</p> <pre><code>graph LR\n    c0[\"128-Ch\n        Electrode\n        Array\"]\n    c1[\"`**Headstage**`\"]\n    c2[\"`**Adapter**`\"]\n    c3[\"Intan Rec\n        Controller\"]\n    c4[\"Intan Rec/Stim\n        Controller\"]\n    c5[\"Programmer\"]\n    c0 &lt;--&gt; c1\n    c1 &lt;----&gt; c2\n    c2 &lt;--&gt; c3\n    c2 &lt;--&gt; c4\n    c2 &lt;--&gt; c5</code></pre> <p>Figure 2. System Architecture of Iris-128S.</p> <p></p> <p></p> <p>Figure 3. Schematic of Iris-128S.</p> <p></p> <p>Here are the descriptions of each component.</p> Component Page Headstage Headstage Adapter Adapter Quickstart Guide Quickstart Guide"},{"location":"iris-128/iris-128s/#specifications","title":"Specifications","text":"<ul> <li>Recording from all 128 channels.</li> <li>Stimulation from 32 designated channels, where up to 16 of them can be selected for simultaneous stimulation.</li> <li>Compatible with Intan Recording Controller and Intan Stim/Record Controller.</li> <li>SEAM8 Samtec connector for interfacing with 128-ch electrode array and compatible with BlackRock Cereplex E headstages.</li> <li>The headstage has a size of 30.2 x 25.5 mm<sup>2</sup>.</li> <li>Omnetics 36-POS connector to interface with Adapter board through a single cable.</li> <li>Adapter board draws power directly from the Intan Recording Controller to power itself and the headstage.</li> <li>On-board power management unit (PMU) in the Adapter board generates the required supplies for the MCU and ADGS5414 switches.</li> <li>Programmer in the Adapter board is only needed to update the firmware in the MCU, i.e., change the state of the ADGS5414 switches. After MCU is programmed, only the Intan controlleres are needed.</li> <li>The adapter has a size of 50 x 40 mm<sup>2</sup>.</li> </ul>"},{"location":"iris-128/iris-128s/adapter_iris128s/","title":"Adapter","text":"<p>The adapter consists of a 36-pin Omnetics connector, a 12-pin Omnetics connector, a 16-pin Omnetics connector, a power management unit (PMU) block, a microcontroller unit (MCU), and a programmer connector. This system is shown in the figure below.</p> <pre><code>graph LR\n    %% PCB Definition\n    PCB1[Headstage]\n\n    subgraph PCB2[Adapter]\n        direction LR\n\n        subgraph b5[\"PMU-MCU\"]\n            direction TB\n            c1[PMU]\n            c2[MCU]\n            c1 --&gt; c2\n        end\n\n        conn1[\"Omnetics-16\n               Conn\"]\n        conn0[\"Omnetics-12\n               Conn\"]\n        subgraph b4[\"36-Pin Conn\"]\n            e6[12]\n            e7[14]\n            e8[10]\n        end\n\n        e6 &lt;--&gt; conn0\n        e6 &lt;--&gt; b5    \n        e7 &lt;--&gt; conn1\n        e8 &lt;--&gt; b5\n\n    end\n\n    b0[\"128 Electrode Array\n        with matching\n        Connector\"]\n\n    %% Top-level connections\n    b0 &lt;--&gt; PCB1\n    PCB1 &lt;----&gt; b4\n    conn1 &lt;--&gt; i1[\"Intan Rec/Stim\n                 Controller\"]\n    conn0 &lt;--&gt; i0[\"Intan Rec\n                 Controller\"]\n    b5 &lt;--&gt; Programmer\n</code></pre> <p>Figure 1. System architecutre of the Adapter.</p> <p></p> <p>The figure below shows the different components of the adapter.</p> <p></p> <p></p> <p>Figure 2. Rendering of the Adapter top and bottom sides indicating its main components.</p> <p></p> <p>The table below shows the main components of the Iris-128S adapter. Note the component correspondance with the previous figure.</p> Component Description <code>RHD +3.3V</code> 64-ch neural recording amplifier chip, Intan. <code>RHS +3.3V</code> 16-ch neural recording/stimulation chip, Intan. <code>J1-1</code> <code>RHD +3.3V</code> pin header. <code>J7-1</code> <code>VDD3V</code> pin header. This +3 V supply is generated by the <code>PMU</code>. <code>J2-1</code> <code>VDD_SW</code> pin header. This +9 V supply is generated by the <code>PMU</code>. <code>J3-1</code> <code>VSS_SW</code> pin header. This -9 V supply is generated by the <code>PMU</code>. <code>J1-2</code>, <code>J7-2</code> <code>J2-2</code>, <code>J3-2</code> <code>GND</code> pin headers. <code>A79623-001</code> 12-pin high-density connector, Omnetics. <code>A79633-001</code> 16-pin high-density connector, Omnetics. <code>A79024-001</code> 36-pin high-density connector, Omnetics. <code>J4</code> SWD 10-pin 0.05' pitch <code>Programming Port</code>. <code>J6</code> <code>Reset Button</code> connected to the MCU. <code>J5</code> <code>Expansion Port</code> with MCU GPIOs. <code>STM32U0</code> <code>STM32U083KCU6</code> Ultra-low-power Arm M0+, 32-bit MCU. <code>PMU</code> Power management unit which generaters +3 V and \u00b19 V. <code>X1</code> <code>ECX-1210B</code> 32.768 kHz Crystal."},{"location":"iris-128/iris-128s/adapter_iris128s/#power-management-unit-pmu","title":"Power Management Unit - PMU","text":"<p>The PMU scheme is to provide the analog switches and MCU with their required voltages without altering the performance of the supply going to the Intan chips. We are placing regulators between any device's voltage supply and the power signal coming from the Intan Recording Controller. Switching noise coming from switching regulators could couple-back into the power input source through the regulators and potentially modify Intan chips performance. To minimize this effect, we are choosing switching regulators with a high switching frequency of &gt; 1 MHz. The 64-Ch Intan Recording chip has two 32-input ADCs which digitize the analog inputs at 30 kSa/s per channel. The signal at the input of these ADCs is then sampled at 32 \\(\\times\\) 30 kSa/s = 960 kHz. Assuming Nyquist, the frequency content of the ADC input is then 480 kHz. The ADP5070 has a switching frequency of 1.2/2.4 MHz which is outside of this signal bandwidth. We will use the switching frequency of 2.4 MHz.</p>"},{"location":"iris-128/iris-128s/adapter_iris128s/#power-source-inputs","title":"Power Source Inputs","text":"Input (Connector) S1 (Omnetics-12) S4 (Omnetics-16) Pin Headers <code>VDD</code> Pin T6 T8 <code>J1</code>-<code>J7</code> <code>GND</code> Pin B6 B8 <code>J1</code>-<code>J7</code> Source Rec Controller Stim Controller Unknown Input Voltage +3.2 - 3.6 V +3.2 - 3.6 V +3.3 V"},{"location":"iris-128/iris-128s/adapter_iris128s/#ground-scheme","title":"Ground Scheme","text":"<p>We have a total of 3 different grounds in the system. These are <code>GND1</code> from the Recording controller, <code>GND2</code> from the Stimulation controller, and <code>GND3</code> from the Pin Headers. We use a commong ground plane for both <code>GND1</code> and <code>GND2</code>, and two connection points between <code>GND1</code> and <code>GND3</code> planes using <code>Net_Ties</code> close to connectors <code>S4</code> and <code>S5</code>.</p>"},{"location":"iris-128/iris-128s/adapter_iris128s/#ground-domains","title":"Ground Domains","text":"GND Domain Components <code>GND1</code> = <code>GND2</code> 2x RHD2164 &amp; 1x RHS2116 <code>GND3</code> PMU + MCU + Switches"},{"location":"iris-128/iris-128s/adapter_iris128s/#power-requirements","title":"Power Requirements","text":""},{"location":"iris-128/iris-128s/adapter_iris128s/#power-requirement-estimation-per-block","title":"Power Requirement Estimation per Block","text":"Component Current # Devices Total <code>STM32U083</code> - Core @ 3.0V (Run Mode) 54 uA/MHz 1 52 uA <code>STM32U083</code> - I/O - Static/Leakage @ 3.0V 10uA + #I/Os*0.1 uA 20 I/Os 12 uA <code>STM32U083</code> - I/O - Dynamic @ 3.0V Negligable,not switching expected N/A 0 uA <code>STM32U083</code> - Peripherals @ 3.0V ~ 35 uA/MHz 1 35 uA <code>STM32U083</code> - Programming ~10 mA 1 10 mA <code>ADGS5414</code> - IDD &lt; 500 uA 8 4 mA <code>ADGS5414</code> - ISS 1 uA 8 8 uA <code>ADGS5414</code> - IL (1 MHz) 30 uA 8 240 uA"},{"location":"iris-128/iris-128s/adapter_iris128s/#output-current-requirement-estimation-per-regulator","title":"Output Current Requirement Estimation per Regulator","text":"Regulator Supply Voltage Iout (Max) Components Required Output Current (Max) <code>ADP7142</code> <code>VDD_SW</code> +9 V 200 mA <code>ADGS5414</code> - VDD 4 mA <code>ADP7182</code> <code>VSS_SW</code> -9 V 200 mA <code>ADGS5414</code> - VSS 8 uA <code>TLV711</code> - Vout1 <code>VDD3V</code> +3 V 200 mA <code>ADGS5414</code> - VL<code>STM32U083</code> - VDD<code>STM32U083</code> - Programming 240 uA100 uA~10 mA <code>TLV711</code> - Vout2 <code>VDDA3V</code> +3 V 200 mA <code>STM32U083</code> - VDDA 50 uA"},{"location":"iris-128/iris-128s/adapter_iris128s/#block-diagram","title":"Block Diagram","text":"<pre><code>graph LR\n    i1[\"`**VDD1 \n        Recording\n        Controller)**\n        3.2-3.6V`\"]\n\n    subgraph pmu[\"`**PMU**`\"]\n    subgraph s1[\"`**ADP5070 - 1A/0.6A**`\"]\n        ADP5070-Vin[\"Vin\n                     2.85-15V\"]\n        ADP5070-VoutPOS[\"VoutPOS\n                         Up to 39V\"]\n        ADP5070-VoutNEG[\"VoutNEG\n                         Down to -39V\"]\n        ADP5070-Vin --&gt; ADP5070-VoutPOS\n        ADP5070-Vin --&gt; ADP5070-VoutNEG\n    end\n\n    subgraph s2[\"`**ADP7142 - 200mA**`\"]\n        ADP7142-Vin[\"Vin\n                     2.85-15V\"]\n        ADP7142-Vout[\"Vout\n                      Adj\n                      +9V\"]\n        ADP7142-Vin --&gt; ADP7142-Vout\n    end\n\n    subgraph s3[\"`**ADP7182 - 200mA**`\"]\n        ADP7182-Vin[\"Vin\n                     -2.7- -28V\"]\n        ADP7182-Vout[\"Vout\n                      Adj\n                      -9V\"]\n        ADP7182-Vin --&gt; ADP7182-Vout\n    end\n\n    subgraph s4[\"`**TLV711 - 200mA**`\"]\n        TLV711-Vin[\"Vin\n                     2-5.5V\"]\n        TLV711-Vout1[\"Vout\n                      Fixed\n                      +3.0V\"]\n        TLV711-Vout2[\"Vout\n                      Fixed\n                      +3.0V\"]\n        TLV711-Vin --&gt; TLV711-Vout1\n        TLV711-Vin --&gt; TLV711-Vout2\n    end\n\n    %% Connections\n\n    ADP5070-VoutPOS --\"`**VDDH**`\"--&gt; ADP7142-Vin\n    ADP5070-VoutNEG --\"`**VSSH**`\"--&gt; ADP7182-Vin\n\n    end\n\n    subgraph s5[\"`**ADGS5414**`\"]\n        ADGS5414-VL[\"VL\n                     2.7-3.3V\"]\n        ADGS5414-VDD[\"VDD\n                      +9V\"]\n        ADGS5414-VSS[\"VSS\n                      -9V\"]\n    end\n\n    subgraph s6[\"`**STM32U083**`\"]\n        STM32U083-VDDA[\"VDDA\n                      1.62/1.8/2.4-3.6V\"]\n        STM32U083-VDD[\"VDD\n                     1.71-3.6V\"]        \n\n    end\n\n    %% Connections\n    i1 --&gt; ADP5070-Vin\n    ADP7142-Vout --&gt; out1[\"`**VDD_SW\n                            +9V**`\"]\n    ADP7182-Vout --&gt; out2[\"`**VSS_SW\n                            -9V**`\"]\n    i1 ----&gt; TLV711-Vin\n    TLV711-Vout1 --&gt; out3[\"`**VDD3V\n                           +3.0V**`\"]\n    TLV711-Vout2 --&gt; out4[\"`**VDDA3V\n                           +3.0V**`\"]\n    out1 --&gt; ADGS5414-VDD\n    out2 --&gt; ADGS5414-VSS\n    out3 --&gt; ADGS5414-VL\n    out3 --&gt; STM32U083-VDD\n    out4 --&gt; STM32U083-VDDA</code></pre> <p>Figure 3. Block diagram of the PMU.</p> <p></p>"},{"location":"iris-128/iris-128s/adapter_iris128s/#microcontroller-unit-mcu-stm32u083","title":"Microcontroller Unit - MCU STM32U083","text":""},{"location":"iris-128/iris-128s/adapter_iris128s/#pin-assignment","title":"Pin Assignment","text":"Pin Number Pin Name Assigned Function Connection 1 VDD Power VDD3V 24 PA14 (SWCLK) Prog. J4-4 (PROG-SWD) 16, 32 GND Power GND 23 PA13 (SWDIO) Prog. J4-2 (PROG-SWD) 4 PF2-NRST Reset/Prog. J4-10 (PROG-SWD), J6 (Button) 5 VDDA/VREF+ Power VDDA3V 17 VDD2 Power VDD3V 2 PC14-OSC32_IN OSC32 Ext. Crystal 3 PC15-OSC32_OUT OSC32 Ext. Crystal 6 PA0-CK_IN GPIO J5-1 (Pin-Header) 7 PA1 GPIO J5-2 (Pin-Header) 8 PA2 GPIO J5-3 (Pin-Header) 9 PA3 GPIO J5-4 (Pin-Header) 10 PA4 GPIO (DAC1_OUT1) J5-5 (Pin-Header) 11 PA5 GPIO J5-6 (Pin-Header) 12 PA6 GPIO J5-7 (Pin-Header) 13 PA7 GPIO J5-8 (Pin-Header) 14 PB0 GPIO (LPUART2_CTS) J5-15 (Pin-Header) 15 PB1 GPIO (LPUART2_RTS_DE) J5-16 (Pin-Header) 18 PA8 GPIO LED D3 19 PA9 GPIO (I2C1_SCL) J5-11, 4.7 k\u03a9 pull-up 20 PA10 GPIO (I2C1_SDA) J5-12, 4.7 k\\(\\Omega\\) pull-up 21 PA11 GPIO J5-13 (Pin-Header) 22 PA12 GPIO J5-14 (Pin-Header) 25 PA15 SPI3_NSS CSb_SW 26 PB3 SPI3_SCK SCLK_SW 27 PB4 SPI3_MISO MISO_SW 28 PB5 SPI3_MOSI MOSI_SW 29 PB6 GPIO (LPUART2_TX) J5-17 (Pin-Header) 30 PB7 GPIO (LPUART2_RX) J5-18 (Pin-Header) 31 PF3-BOOT0 BOOT0 GND (via 0\\(\\Omega\\)) 33 Exposed Pad Exposed Pad GND"},{"location":"iris-128/iris-128s/adapter_iris128s/#pin-connections","title":"Pin Connections","text":""},{"location":"iris-128/iris-128s/adapter_iris128s/#power-pins-vdd-1-17-vdda-5-gnd-16-32","title":"Power: Pins VDD (1, 17), VDDA (5), &amp; GND (16, 32)","text":"<ul> <li>V<sub>DD</sub>: External power supply for I/Os (V<sub>DDIO1</sub>), the internal regulator and the system analog.</li> <li>V<sub>DDA</sub>: External power supply for embedded analog components. It is independent from V<sub>DD</sub>.</li> <li>No power up/down sequence required.</li> </ul> <p>Bypass Capacitors:</p> <ul> <li><code>VDD</code> - <code>VSS</code><ul> <li>1x 4.7 uF ceramic cap.</li> <li>1x 100 nF ceramic cap per VDD pin.</li> </ul> </li> <li><code>VDDA</code> - <code>VSS</code><ul> <li>1x 1 uF ceramic cap.</li> <li>1x 100 nF ceramic cap.</li> <li>1x 10 nF ceramic cap.</li> </ul> </li> </ul>"},{"location":"iris-128/iris-128s/adapter_iris128s/#swd-pins-swdio-23-swclk-24","title":"SWD: Pins SWDIO (23), SWCLK (24)","text":"<ul> <li>Connected to <code>J4</code> connector without any pull-up or pull-down resistors.</li> </ul>"},{"location":"iris-128/iris-128s/adapter_iris128s/#boot0-pin-boot0-31","title":"BOOT0: Pin BOOT0 (31)","text":"<ul> <li>1x 0 \u03a9 resistor to <code>GND</code>.</li> </ul>"},{"location":"iris-128/iris-128s/adapter_iris128s/#reset-pin-nrst-4","title":"Reset: Pin NRST (4)","text":"<ul> <li>This pin is internally connected to a permanent pull-up resistor, R<sub>PU</sub>.</li> <li>Connected to <code>J4</code> connector for programming and pulse-button switch to reset the device locally..</li> <li>Filter capacitor of 0.1 uF to ground placed as close as possible to the device.</li> </ul>"},{"location":"iris-128/iris-128s/adapter_iris128s/#lf-external-oscillator-2-pc14-osc32_in-3-pc15-osc32_out","title":"LF External Oscillator (2, PC14-OSC32_IN; 3, PC15-OSC32_OUT)","text":"<p>The <code>X1</code> crystal used in the board is the ECX-1210B by ECS, with a C<sub>L</sub> = 6 pF.</p>"},{"location":"iris-128/iris-128s/adapter_iris128s/#j4-programming-connector","title":"J4 - Programming Connector","text":"Pin Number Description Pin Number Description 1 T_VCC (VDD3V) 2 T_SWDIO (PA13) 3 GND 4 T_SWCLK (PA14) 5 GND 6 T_SWO (NC) 7 T_JRCLK/NC (NC) 8 T_JTDI/NC (NC) 9 GNDDetect (GND) 10 T_NRST (NRST)"},{"location":"iris-128/iris-128s/adapter_iris128s/#j5-gpio-connector","title":"J5 - GPIO Connector","text":"Pin Number Description Pin Number Description 1 PA0 2 PA1 3 PA2 4 PA3 5 PA4 (SPI1_NSS) 6 PA5 (SPI1_SCK) 7 PA6 (SPI1_MISO) 8 PA7 (SPI1_MOSI) 9 GND 10 VDD3V 11 PA9 (I2C1_SCL) 12 PA10 (I2C1_SDA) 13 PA11 14 PA12 15 PB0 16 PB1 17 PB6 (LPUART2_TX) 18 PB7 (LPUART2_RX) 19 GND 20 VDD3V"},{"location":"iris-128/iris-128s/adapter_iris128s/#3-programming-the-adapter-mcu","title":"3. Programming the Adapter MCU","text":""},{"location":"iris-128/iris-128s/adapter_iris128s/#mcu-peripherals-used-in-the-project","title":"MCU Peripherals used in the Project","text":"<ol> <li><code>RCC</code>: System clock configuration.</li> <li><code>GPIO</code>: Configuring MCU I/Os.</li> <li><code>SPI3</code>: SPI block.</li> </ol>"},{"location":"iris-128/iris-128s/adapter_iris128s/#gpios","title":"GPIOs","text":"PinName Signalon Pin GPIOOutput Level GPIOMode GPIOPull-up/Pull-down PA8 N/A Low Output Push Pull No pull-up/pull-down PA15 N/A (SPI3_NSS) Low Output Push Pull No pull-up/pull-down PB3 SPI3_SCK N/A Alternate Function Push Pull No pull-up/pull-down PB4 SPI3_MISO N/A Alternate Function Push Pull No pull-up/pull-down PB5 SPI3_MOSI N/A Alternate Function Push Pull No pull-up/pull-down"},{"location":"iris-128/iris-128s/adapter_iris128s/#spi-block-in-mcu","title":"SPI Block in MCU","text":"Parameter Value Mode Full-Duplex Master Frame Format Motorola Data Size 8 bits First Bit MSB first Baud Rate 62.5 kb/s CPOL Low CPHA 1 Edge"},{"location":"iris-128/iris-128s/adapter_iris128s/#building-flashing","title":"Building &amp; Flashing","text":"<p>The <code>adapter</code> board has a <code>STM32U083</code> ultra-low-power Arm M0+ 32-bit microcontroller (MCU) which is used to program the state of the switches in the headstage through <code>SPI</code> communication. You can use any tool you want to build the firmware and program the MCU; here we use the <code>STM32Cube</code> tools. The figure below shows a screenshot of the <code>STM32CubeIDE</code> with the <code>main.c</code> file in the center panel. You can download all the project documents from our github repository. To build the project, click on the  button.</p> <p></p> <p>Figure 7. Screenshoot of the STM32CubeIDE with the main.c file in the center panel.</p> <p></p> <p>To program the MCU, we use the <code>STM32CubeProgrammer</code>. Connect the <code>STLINK-V3</code> to the computer and the <code>adapter</code> board using the 10-pin ribbon cable. Press the <code>Connect</code> button to connect and identify the board. Program or <code>flash</code> the MCU by clicking on <code>Program</code>.</p> <p></p> <p>Figure 8. Screenshoot of the STM32CubeProgrammer.</p> <p></p>"},{"location":"iris-128/iris-128s/adapter_iris128s/#changing-the-state-of-the-switches","title":"Changing the State of the Switches","text":"<p>You can change the state of each of the switches in the eight octal <code>ADGS5414</code> by updating the values of the constants shown below. Notice that the bit <code>swX[Y]</code> corresponds to the <code>Y</code> switch of component <code>uX</code>, where <code>X</code>,<code>Y</code> \\(\\in \\{1,2,...8 \\}\\) . The value of <code>0</code> indicates the switch is open whereas the <code>1</code> indicates it is closed.</p> Function Actions Recording <code>OPEN</code> the switch to the RHS2116 and <code>CLOSE</code> the one to the RHD2164. Stimulation <code>CLOSE</code> the switch to the RHS2116 and <code>OPEN</code> the one to the RHD2164."},{"location":"iris-128/iris-128s/adapter_iris128s/#example-code","title":"Example Code","text":"<pre><code>/* Switches states: swX=[7..0] */\n// Default values\nconst char sw1 = (char)(0b00000000);\nconst char sw2 = (char)(0b00000000);\nconst char sw3 = (char)(0b11111111);\nconst char sw4 = (char)(0b11111111);\nconst char sw5 = (char)(0b11111111);\nconst char sw6 = (char)(0b11111111);\nconst char sw7 = (char)(0b00000000);\nconst char sw8 = (char)(0b00000000);\n</code></pre> <p>Warning</p> <p>When configuring a stimulation channel, make sure to <code>OPEN</code> the switch connected to the <code>RHD2164</code>. Failure to do so can cause damage to the <code>RHD2164</code> due to the possibility of higher than expected voltages at its input.</p>"},{"location":"iris-128/iris-128s/adapter_iris128s/#fw-variables-values-for-recording-through-rhd2164-chips","title":"FW variables values for recording through RHD2164 chips","text":"Variable Value sw1 0b00000000 sw2 0b00000000 sw3 0b11111111 sw4 0b11111111 sw5 0b11111111 sw6 0b11111111 sw7 0b00000000 sw8 0b00000000"},{"location":"iris-128/iris-128s/adapter_iris128s/#fw-variables-values-for-stim-through-rs0","title":"FW variables values for Stim through RS0","text":"Variable Value sw1 0b00000000 sw2 0b00000000 sw3 0b11111111 sw4 0b11111111 sw5 0b10111111 sw6 0b11111111 sw7 0b00000000 sw8 0b00000010"},{"location":"iris-128/iris-128s/adapter_iris128s/#further-development","title":"Further Development","text":"<p>The current use of the MCU is to program the state of the switches in the headstage after the <code>adapter</code> board is powered on. You could further expand the functions of the MCU to adapt the <code>Iris-128s</code> neural interface to your project. For this purpose, the <code>adapter</code> board features a <code>reset button</code>, a <code>32 kHz crystal</code>, and a <code>expansion port</code> with flexible <code>GPIO</code> for easy prototyping and development.</p>"},{"location":"iris-128/iris-128s/adapter_iris128s/#pcb","title":"PCB","text":"<p>The PCB for the adapter has a size of 50 x 40 mm<sup>2</sup>. The table below shows the PCB specifications.</p>"},{"location":"iris-128/iris-128s/adapter_iris128s/#pcb-specifications","title":"PCB Specifications","text":"PCB Specification Value Size 50 x 40 mm<sup>2</sup> Trace Width/Space 5 mil / 5 mil Layers 4 Thru-Hole Via (Hole/Diameter) 10 mil / 20 mil Thickness 0.062 in (1.6 mm) Surface Finish ENIG Copper Weight 1 oz Dielectric Standard FR4"},{"location":"iris-128/iris-128s/headstage_iris128s/","title":"Headstage","text":"<p>The headstage consists of the input 128-pin connector (Conn1), the analog switches (Switches), the recording (RHD2164) and stimulation (RHS2116) chips, and the output 36-pin connector (Conn2). This system is shown in the figure below, where the numbers inside the Conn1 and Conn2 blocks represent a set of pins from the connector.</p> <pre><code>graph LR\n    %% PCB Definition\n    subgraph PCB1[Headstage]\n        direction LR\n        %% Internal Components\n        r0[RHD2164]\n        r1[RHD2164]\n        s0[RHS2116]\n\n        subgraph sw[Switches]\n            sw0[\"SW8\n                x4\"]\n            sw1[\"SW8\n                x4\"]\n        end\n\n        subgraph b2[\"Conn1\"]\n            e0[64]\n            e1[32]\n            e2[32]\n        end\n\n        subgraph b3[\"Conn2\"]\n            e3[12]\n            e4[14]\n            e5[10]\n        end\n\n        %% Connections\n        e0 ---&gt; r0\n        e1 ---&gt; r1\n        e2 &lt;--&gt; sw0 --&gt; r1\n        e2 &lt;--&gt; sw1 &lt;--&gt; s0\n        r0 &lt;--&gt; e3\n        r1 &lt;--&gt; e3\n        s0 &lt;--&gt; e4\n        sw &lt;---&gt; e5\n    end\n\n    subgraph PCB2[Adapter]\n\n    end\n\n    b0[\"128 Electrode Array\n        with matching\n        Conector\"]\n\n    %% Top-level connections\n    b0 &lt;--&gt; b2\n    b3 &lt;--&gt; PCB2\n    PCB2 &lt;--&gt; i0[\"Intan Rec\n                 Controller\"]\n    PCB2 &lt;--&gt; i1[\"Intan Rec/Stim\n                 Controller\"]\n    PCB2 &lt;--&gt; Programmer\n</code></pre> <p>Figure 1. System architecutre of the Headstage.</p> <p></p> <p></p> <p>Figure 2. Schematic of the Headstage.</p> <p></p> <p>We describe each component below:</p> Component Part Manufacturer Description <code>Conn1</code> SEAM8-20-S02.0-S-08-3 Samtec 160-pin connector <code>Conn2</code> A79024-001 Omnetics 36-pin connector <code>SW8</code> ADGS5414BCPZ ADI Analog switches <code>RHD2164</code> RHD2164 Intan Recording chip <code>RHS2116</code> RHS2116 Intan Stimulation chip <p></p> <p>The PCB of the headstage has a size of 30.2 x 25.5 mm<sup>2</sup>. </p> <p></p> <p></p> <p>Figure 3. Rendering of the Headstage PCB (left) top and (right) bottom sides.</p> <p></p>"},{"location":"iris-128/iris-128s/headstage_iris128s/#electrode-array-connector","title":"Electrode Array Connector","text":"<p>We are currently using the SEAM8 Samtec connector for interfacing with 128-ch electrode array. The top and bottom two rows are dedicated for <code>GND</code>, <code>3.3V</code>, <code>LED</code>, and <code>REF</code> connectors. The remaining 16x8 of them are for connecting to the 128 electrodes. The first 6 columns to the left are recording only <code>R</code> pins while the first 2 columns to the right are recording and simulation <code>RS</code> pins. These pins are shown in the figure below.</p> <p></p> <p>Figure 4. Details of the electrode array connector footprint.</p> <p></p> <p>We describe each pin type below:</p> Pin Type # Pins Description <code>R</code> 96 Recording only pins where 64 of them are connected to all inputs of 1x <code>R64</code> chip and the rest to 32 inputs of a second <code>R64</code> chip. <code>RS</code> 32 Recording and stimulation pins connected to all 64x inputs of 8x <code>ADGS5414</code> octal analog switches such that each <code>RS</code> pin is connected to 2x analog switches inputs. <code>REF</code> 8 These pins are all shorted together and are connected to the reference electrode. <code>GND</code> 18 These pins are all shorted and connected to the headstage ground. <code>3.3V</code> 4 Unconnected. <code>LED</code> 2 Unconnected. <p></p>"},{"location":"iris-128/iris-128s/headstage_iris128s/#analog-switches","title":"Analog Switches","text":"<p>The analog switches connect the 32x <code>RS</code> pins to 32x inputs of one <code>RHD2164</code> chip and all 16x inputs of the <code>RHS2116</code> chip using 8x <code>ADGS5414</code> chips. This connection is shown in the figure below.</p> <p></p> <p>Figure 5. Analog switches configuration.</p> <p></p> <p>The switches are placed at the input of the <code>RHS2116</code> chip. This Intan chip uses stimulation supplies of +/-7 V, which means that the voltage compliance at the inputs of the chip should be +/-7 V. This fact rules out the majority of standard analog switches/muxes since their input/output voltage range is usually limited to +/-2.5 V or +5 V. In addition, the input/output capacitances of the switches add parasitic capacitances which could affect the performance of the neural amplifiers. The figure below shows the added capacitance at the input of each amplifier caused by the analog switches. Thus, we selected the <code>ADGS5414</code> octal analog switch because it has low parasitic switch capacitances and withstand an input voltage range higher than +/-7 V. These switches are powered with supplies higher or equal to +/-9 V.</p> <p></p> <p>Figure 6. Input switches capacitances.</p> <p></p> <p>One nice feature of the <code>ADGS5414</code> is its capability to daisy-chain many of them, creating a long shift-register using their SPI blocks.</p> <p></p> <p>Figure 7. Daisy-chain configuration of `ADGS5414` octal analog switches.</p> <p></p> <p>The <code>GND</code> for the analog switches is shared with the <code>RHD2164</code> and <code>RHS2116</code> chips.</p>"},{"location":"iris-128/iris-128s/headstage_iris128s/#rhd2164-rhs2116","title":"RHD2164 &amp; RHS2116","text":"<p>The <code>RHD2164</code> and <code>RHS2116</code> Intan chips are used here without any modification from their usual configuration. Both <code>RHD2164</code> have a shared supply <code>VDD1</code> coming from the recording controller, and are set up with <code>LVDS</code> outputs. The <code>RHS2116</code> chip has independent supplies of <code>VDD2</code>, <code>VSTIMp</code>, and <code>VSTIMm</code> coming from the stimulation controller, and is set up with <code>LVDS</code> outputs. All 3x chips share the same <code>REF</code> electrode and the same <code>GND</code>. The <code>GND</code> is also shared with the analog switches.</p>"},{"location":"iris-128/iris-128s/headstage_iris128s/#interface-connector","title":"Interface Connector","text":"<p>We are using the 36-pin A79024-001 Omnetics connector to bring all the signals from the headstage to the controller PCB. Using a single connector helps with simplifying the design. We assign the pins in the connector based on the three main parts of the headstage: recording, stimulation, and switches. This can be seen in the table and figure below.</p> <p></p> Pin Number Description Pin Number Description <code>T18</code> VSTIMm <code>B18</code> VDD2 <code>T17</code> VSTIMp <code>B17</code> VDD1 <code>T16</code> GND <code>B16</code> GND <code>T15</code> MISO1m <code>B15</code> CSbm <code>T14</code> MISO1p <code>B14</code> CSbp <code>T13</code> MISO2m <code>B13</code> SCLKm <code>T12</code> MISO2p <code>B12</code> SCLKp <code>T11</code> MOSIm <code>B11</code> CSbm_STIM <code>T10</code> MOSIp <code>B10</code> CSbp_STIM <code>T9</code> MOSIm_STIM <code>B9</code> SCLKm_STIM <code>T8</code> MOSIp_STIM <code>B8</code> SCLKp_STIM <code>T7</code> Unused <code>B7</code> MISOm_STIM <code>T6</code> Unused <code>B6</code> MISOp_STIM <code>T5</code> CSb_SW <code>B5</code> SCLK_SW <code>T4</code> MISO_SW <code>B4</code> MOSI_SW <code>T3</code> GND <code>B3</code> GND <code>T2</code> VDD_SW <code>B2</code> VDD3 <code>T1</code> VSS_SW <code>B1</code> VDD3 <p></p> <p></p> <p>Figure 8. Details of the Interface Connector footprint.</p>"},{"location":"iris-128/iris-128s/headstage_iris128s/#pcb","title":"PCB","text":"<p>We use an 8 layer stack where we prioritize shielding of the traces connecting the electrode array with the analog switches and recording chip <code>RHD2164</code>. The table below shows a summary of our strategy. The top L1 and bottom L2 layers are used for minimal local routing around the components and <code>GND</code> plane. Layer L2 is used for supply and SPI routing of the analog switches. Adding a <code>GND</code> plane allows us to also use this layer for sensitive routing between the electrode pins and the analog switches (see figure below). Layer L3 is used as a <code>GND</code> plane to shield any signal routing from the switches supplies and SPI routing. Layers L4, L5, and L6 are used for analog routing between the electrode pins, switches, recording <code>RHD2164</code>, and stimulation <code>RHS2116</code> chips. Layer L4 is also used to route the <code>RHD2164</code> supplies from the interface connector. This routing is localized to the far right side of the board and shielded with <code>GND</code> planes in layers L3, L4, and L5. Layer L7 is used for some additional local routing between the switches and to bring the SPI signals to the interface connector. The SPI routing is shielded with a <code>GND</code> plane in layers L6, L7, and, where possible, in layer L8.</p> <p>The PCB for the headstage has a size of 30.2 x 25.5 mm<sup>2</sup>. The table below shows the PCB specifications and the figures below show a rendering of the PCB top and bottom sides.</p>"},{"location":"iris-128/iris-128s/headstage_iris128s/#pcb-specifications","title":"PCB Specifications","text":"PCB Specification Value Size 30.2 x 25.5 mm<sup>2</sup> Trace Width/Space 3 mil / 3 mil Layers 8 Thru-Hole Via (Hole/Diameter) 8 mil / 14 mil Microvia  (Hole/Diameter) 6 mil / 12 mil Thickness 0.039 in (1 mm) Surface Finish ENIG Copper Weight 1 oz"},{"location":"iris-128/iris-128s/headstage_iris128s/#pcb-stack-up","title":"PCB Stack Up","text":"Layer Notes 1 Minimal local routing + <code>GND</code> plane Prepreg 2 Supplies + SPI + some electrode signal routing + <code>GND</code> plane Core 3 GND plane Prepreg 4 Signal routing + some supply traces + <code>GND</code> plane Core 5 Signal routing + <code>GND</code> plane Prepreg 6 Signal routing + <code>GND</code> plane Core 7 <code>GND</code> plane + SPI routing Prepreg 8 Minimal local routing + <code>GND</code> plane"},{"location":"iris-128/iris-128s/headstage_iris128s/#headstage-pcb-vias","title":"Headstage PCB Vias","text":"Layer Via1 \u03bcVia1 \u03bcVia2 \u03bcVia3 \u03bcVia4 \u03bcVia5 \u03bcVia6 \u03bcVia7 1 ----- ----- | | 2 | ----- ----- | | 3 | ----- ----- | | 4 | ----- ----- | | 5 | ----- ----- | | 6 | ----- ----- | | 7 | ----- ----- | | 8 ----- ----- <p>Figure 9. PCB layout with detailed routing for each layer.</p> <p></p> <p>The reference electrode <code>REF</code> is routed in layer L6 with its trace shielded with <code>GND</code> planes in layers L5, L6, and L7. This is shown in the figure below.</p> <p></p> <p>Figure 10. Reference electrode routing.</p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/","title":"Iris-128S Quickstart Guide","text":"<p>Info</p> <p>Open-Source 128-Channel Headstage for Neural Recording and Stimulation (Based on Jacobs et al., 2025 \u2013 \u201cIris 128x: Open-Source 128-Channel Headstages for Neural Stimulation and Recording\u201d)</p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#1-system-overview","title":"1. System Overview","text":"<p>The <code>Iris-128S</code> neural interface consists of a <code>headstage</code> and an <code>adapter</code>, and provides with 128-channel, selective bidirectional recording and stimulation capability using two <code>RHD2164</code> and one <code>RHS2116</code> Intan integrated amplifier and amplifier/stimulation chips. It interfaces with thin-film microelectrode arrays through a Samtec <code>SEAF8</code> connector and communicates with an Intan RHD Controller and a RHS Controller via low-voltage differential signaling (LVDS) through Intan Omnetics cables. The <code>headstage</code> and <code>adapter</code> are connected with a <code>36-wire custom cable</code>. A microcontroller (MCU) in the <code>adapter</code> can be programmed with a MCU-compatible programmer.</p> <p>The architecture of <code>Iris-128S</code> neural interface is shown in the figure below.</p> <pre><code>graph LR\n    c0(\"128-Ch\n        Electrode\n        Array\")\n    c1(\"`**Iris-128S\n        Headstage**`\")\n    c2(\"`**Iris-128S\n        Adapter**`\")\n    c3(\"Intan RHD\n        Controller\")\n    c4(\"Intan RHS\n        Controller\")\n    c5(\"Programmer\")\n    c6(\"Computer\")\n    c0 &lt;--&gt; c1\n    c1 &lt;-- 36-Wire\n           Custom Cable --&gt; c2\n    c2 &lt;-- 12-Pin\n           Intan Cable --&gt; c3\n    c2 &lt;-- 16-Pin\n           Intan Cable --&gt; c4\n    c2 &lt;-- 10-Pin\n           Flat Cable --&gt; c5\n    c3 &lt;--&gt; c6\n    c4 &lt;--&gt; c6\n    c5 &lt;--&gt; c6</code></pre> <p>Figure 1. System Architecture of Iris-128S.</p> <p></p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#2-hardware-components","title":"2. Hardware Components","text":"<p>List of required components:</p> <ul> <li>Iris-128S Headstage</li> <li>Iris-128S Adapter</li> <li>36-Wire Custom Cable</li> <li>160-pin Samtec SEAF8 connector</li> <li>Electrode Array</li> <li>Intan RHD Controller</li> <li>Intan RHS Controller</li> <li>12-Pin Intan Cable</li> <li>16-Pin Intan Cable</li> <li>10-Pin Ribbon Cable</li> <li>STLINK-V3 Programmer</li> <li>Computer</li> </ul> <p></p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#21-iris-128s-headstage","title":"2.1. Iris-128S Headstage","text":"<p>The figure below shows the different components of the headstage.</p> <p></p> <p></p> <p>Figure 2. Photos of the Headstage top and bottom sides indicating its main components.</p> <p></p> <p>The table below shows the main components of the Iris-128S headstage. Note the component correspondance with the previous figure.</p> Component Description <code>RHD2164</code> 64-ch neural recording amplifier chip, Intan. <code>RHS2116</code> 16-ch neural recording/stimulation chip, Intan. <code>ADGS5414</code> Octal high-voltage analog switch, Analog Devices. <code>SEAM8-20</code> 160-pin high-density connector, Samtec. <code>A79024-001</code> 36-pin high-density connector, Omnetics. <code>R14</code> Unpopulated resistor which can be used to connect <code>REF</code> and <code>GND</code>. <code>REF</code> Reference pin. <code>GND</code> GND pin. <code>VDD1</code> +3.3 V Supply for <code>RHD2164</code> chips, testpoint. <code>VDD2</code> +3.3 V Supply for <code>RHS2116</code> chip, testpoint. <code>VDD3</code> +3 V Supply to <code>ADGS5414</code> chip, testpoint. <code>VDD_SW</code> +9 V Supply for <code>ADGS5414</code> chip, testpoint. <code>VSS_SW</code> -9 V Supply for <code>ADGS5414</code> chip, testpoint. <code>VSTIMp</code> +7 V Supply for <code>RHS2116</code> chip, testpoint. <code>VSTIMm</code> -7 V Supply for <code>RHS2116</code> chip, testpoint."},{"location":"iris-128/iris-128s/quickstart_iris128s/#22-electrode-mapping","title":"2.2. Electrode Mapping","text":"<p>The figure below shows the mapping between the Electrode Array Connector, RHD2164 recording chips, and RHS2116 stim/record chip.</p> <p></p> <p>Figure 3. Electrode array connector mapping.</p> <p></p> <p>The figure below shows the daisy-chain SPI connection for the <code>ADGS5414</code> analog switches.</p> <pre><code>graph LR\n\n    subgraph ADGS5414-U8\n        direction LR\n        SDI8 --&gt; SDO8\n    end\n    subgraph ADGS5414-U7\n        direction LR\n        SDI7 --&gt; SDO7\n    end\n    subgraph ADGS5414-U1\n        direction LR\n        SDI1 --&gt; SDO1\n    end\n\n    MOSI_SW --&gt; SDI8\n    SDO8 --&gt; SDI7\n    SDO7 -..-&gt; SDI1\n    SDO1 --&gt; MISO_SW</code></pre> <p>Figure 4. Analog switches daisy-chain SPI connection.</p> <p></p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#analog-switches-state","title":"Analog Switches State","text":"Analog Switch <code>SWX_EN</code> Description <code>UX-Y</code> 01 OpenClosed <p><code>X</code>,<code>Y</code>= {1,..,8}</p> <p></p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#recording-electrodes","title":"Recording Electrodes","text":"Electrode ArrayConnector Pin RHD2164Pin Electrode ArrayConnector Pin RHD2164Pin <code>R0</code> REC0IN1 <code>R48</code> REC0IN4 <code>R1</code> REC0IN54 <code>R49</code> REC0IN6 <code>R2</code> REC0IN62 <code>R50</code> REC0IN26 <code>R3</code> REC0IN60 <code>R51</code> REC0IN31 <code>R4</code> REC0IN58 <code>R52</code> REC0IN33 <code>R5</code> REC0IN56 <code>R53</code> REC0IN22 <code>R6</code> REC0IN3 <code>R54</code> REC0IN13 <code>R7</code> REC0IN29 <code>R55</code> REC0IN15 <code>R8</code> REC0IN46 <code>R56</code> REC0IN14 <code>R9</code> REC0IN48 <code>R57</code> REC0IN18 <code>R10</code> REC0IN52 <code>R58</code> REC0IN20 <code>R11</code> REC0IN50 <code>R59</code> REC0IN24 <code>R12</code> REC0IN5 <code>R60</code> REC1IN46 <code>R13</code> REC0IN27 <code>R61</code> REC0IN12 <code>R14</code> REC0IN59 <code>R62</code> REC0IN17 <code>R15</code> REC0IN63 <code>R63</code> REC1IN17 <code>R16</code> REC0IN45 <code>R64</code> REC1IN0 <code>R17</code> REC0IN47 <code>R65</code> REC1IN16 <code>R18</code> REC0IN7 <code>R66</code> REC1IN63 <code>R19</code> REC0IN25 <code>R67</code> REC1IN8 <code>R20</code> REC0IN51 <code>R68</code> REC0IN21 <code>R21</code> REC0IN55 <code>R69</code> REC1IN2 <code>R22</code> REC0IN43 <code>R70</code> REC1IN18 <code>R23</code> REC0IN61 <code>R71</code> REC1IN4 <code>R24</code> REC0IN9 <code>R72</code> REC1IN61 <code>R25</code> REC0IN23 <code>R73</code> REC1IN26 <code>R26</code> REC0IN40 <code>R74</code> REC0IN19 <code>R27</code> REC0IN35 <code>R75</code> REC1IN20 <code>R28</code> REC0IN57 <code>R76</code> REC1IN6 <code>R29</code> REC0IN41 <code>R77</code> REC1IN22 <code>R30</code> REC0IN11 <code>R78</code> REC1IN45 <code>R31</code> REC0IN16 <code>R79</code> REC1IN43 <code>R32</code> REC0IN30 <code>R80</code> REC1IN53 <code>R33</code> REC0IN32 <code>R81</code> REC1IN37 <code>R34</code> REC0IN53 <code>R82</code> REC1IN24 <code>R35</code> REC0IN39 <code>R83</code> REC1IN10 <code>R36</code> REC0IN0 <code>R84</code> REC1IN47 <code>R37</code> REC0IN10 <code>R85</code> REC1IN55 <code>R38</code> REC0IN36 <code>R86</code> REC1IN41 <code>R39</code> REC0IN38 <code>R87</code> REC1IN42 <code>R40</code> REC0IN49 <code>R88</code> REC1IN12 <code>R41</code> REC0IN37 <code>R89</code> REC1IN28 <code>R42</code> REC0IN2 <code>R90</code> REC1IN59 <code>R43</code> REC0IN8 <code>R91</code> REC1IN57 <code>R44</code> REC0IN28 <code>R92</code> REC1IN51 <code>R45</code> REC0IN34 <code>R93</code> REC1IN49 <code>R46</code> REC0IN42 <code>R94</code> REC1IN39 <code>R47</code> REC0IN44 <code>R95</code> REC1IN44 <p>Connections: <code>REC0INX</code> <code>U9</code>; <code>REC1INX</code> <code>U10</code></p> <p></p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#stimulatingrecording-electrodes","title":"Stimulating/Recording Electrodes","text":"<p>Connected to RHS2116</p> Electrode ArrayConnector Pin RHS2116Pin Switch FW Variable <code>RS0</code> STIM9 U8-2 sw8[1] <code>RS1</code> STIM9 U8-1 sw8[0] <code>RS2</code> STIM8 U8-3 sw8[2] <code>RS3</code> STIM8 U8-4 sw8[3] <code>RS4</code> STIM11 U8-5 sw8[4] <code>RS5</code> STIM11 U8-6 sw8[5] <code>RS6</code> STIM4 U8-8 sw8[7] <code>RS7</code> STIM4 U8-7 sw8[6] <code>RS8</code> STIM3 U7-2 sw7[1] <code>RS9</code> STIM3 U7-1 sw7[0] <code>RS10</code> STIM0 U7-3 sw7[2] <code>RS11</code> STIM0 U7-4 sw7[3] <code>RS12</code> STIM14 U7-7 sw7[6] <code>RS13</code> STIM12 U7-5 sw7[4] <code>RS14</code> STIM12 U7-6 sw7[5] <code>RS15</code> STIM14 U7-8 sw7[7] <code>RS16</code> STIM15 U2-1 sw2[0] <code>RS17</code> STIM15 U2-2 sw2[1] <code>RS18</code> STIM13 U2-4 sw2[3] <code>RS19</code> STIM13 U2-3 sw2[2] <code>RS20</code> STIM1 U2-6 sw2[5] <code>RS21</code> STIM1 U2-5 sw2[4] <code>RS22</code> STIM5 U2-7 sw2[6] <code>RS23</code> STIM5 U2-8 sw2[7] <code>RS24</code> STIM6 U1-1 sw1[0] <code>RS25</code> STIM6 U1-2 sw1[1] <code>RS26</code> STIM2 U1-4 sw1[3] <code>RS27</code> STIM2 U1-3 sw1[2] <code>RS28</code> STIM7 U1-6 sw1[5] <code>RS29</code> STIM7 U1-5 sw1[4] <code>RS30</code> STIM10 U1-7 sw1[6] <code>RS31</code> STIM10 U1-8 sw1[7] <p>Connections: <code>STIMX</code> <code>U12</code></p> <p></p> <p>Connected to RHD2164</p> Electrode ArrayConnector Pin RHD2164Pin Switch FW Variable <code>RS0</code> REC1IN60 U5-7 sw5[6] <code>RS1</code> REC1IN62 U5-8 sw5[7] <code>RS2</code> REC1IN58 U5-6 sw5[5] <code>RS3</code> REC1IN56 U5-5 sw5[4] <code>RS4</code> REC1IN38 U5-4 sw5[3] <code>RS5</code> REC1IN36 U5-3 sw5[2] <code>RS6</code> REC1IN31 U5-1 sw5[0] <code>RS7</code> REC1IN34 U5-2 sw5[1] <code>RS8</code> REC1IN27 U6-7 sw6[6] <code>RS9</code> REC1IN29 U6-8 sw6[7] <code>RS10</code> REC1IN25 U6-6 sw6[5] <code>RS11</code> REC1IN23 U6-5 sw6[4] <code>RS12</code> REC1IN3 U6-2 sw6[1] <code>RS13</code> REC1IN7 U6-4 sw6[3] <code>RS14</code> REC1IN5 U6-3 sw6[2] <code>RS15</code> REC1IN1 U6-1 sw6[0] <code>RS16</code> REC1IN9 U3-8 sw3[7] <code>RS17</code> REC1IN11 U3-7 sw3[6] <code>RS18</code> REC1IN15 U3-5 sw3[4] <code>RS19</code> REC1IN13 U3-6 sw3[5] <code>RS20</code> REC1IN30 U3-3 sw3[2] <code>RS21</code> REC1IN14 U3-4 sw3[3] <code>RS22</code> REC1IN19 U3-2 sw3[1] <code>RS23</code> REC1IN21 U3-1 sw3[0] <code>RS24</code> REC1IN32 U4-8 sw4[7] <code>RS25</code> REC1IN33 U4-7 sw4[6] <code>RS26</code> REC1IN40 U4-5 sw4[4] <code>RS27</code> REC1IN35 U4-6 sw4[5] <code>RS28</code> REC1IN50 U4-3 sw4[2] <code>RS29</code> REC1IN48 U4-4 sw4[3] <code>RS30</code> REC1IN52 U4-2 sw4[1] <code>RS31</code> REC1IN54 U4-1 sw4[0] <p>Connections: <code>REC1INX</code> <code>U10</code></p> <p></p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#23-36-wire-custom-cable","title":"2.3. 36-Wire Custom Cable","text":"<p>The 36-wire custom cable is made out of two 36-pos dual row cable assembly (A79029-001) connected in a 1-to-1 fashion. Each wire connection is soldered and protected with a heat-shrinking tube. Additional heat-shrinking tubes are placed near the connectors. A metal shielding mesh is wrapped around the cable.</p> <p></p> <p>Figure 5. 36-Wire Custom Cable.</p> <p></p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#24-adapter","title":"2.4. Adapter","text":"<p>The figure below shows the different components of the adapter.</p> <p></p> <p></p> <p>Figure 6. Rendering of the Adapter top and bottom sides indicating its main components.</p> <p></p> <p>The table below shows the main components of the Iris-128S adapter. Note the component correspondance with the previous figure.</p> Component Description <code>RHD +3.3V</code> 64-ch neural recording amplifier chip, Intan. <code>RHS +3.3V</code> 16-ch neural recording/stimulation chip, Intan. <code>J1-1</code> <code>RHD +3.3V</code> pin header. <code>J7-1</code> <code>VDD3V</code> pin header. This +3 V supply is generated by the <code>PMU</code>. <code>J2-1</code> <code>VDD_SW</code> pin header. This +9 V supply is generated by the <code>PMU</code>. <code>J3-1</code> <code>VSS_SW</code> pin header. This -9 V supply is generated by the <code>PMU</code>. <code>J1-2</code>, <code>J7-2</code> <code>J2-2</code>, <code>J3-2</code> <code>GND</code> pin headers. <code>A79623-001</code> 12-pin high-density connector, Omnetics. <code>A79633-001</code> 16-pin high-density connector, Omnetics. <code>A79024-001</code> 36-pin high-density connector, Omnetics. <code>J4</code> SWD 10-pin 0.05' pitch <code>Programming Port</code>. <code>J6</code> <code>Reset Button</code> connected to the MCU. <code>J5</code> <code>Expansion Port</code> with MCU GPIOs. <code>STM32U0</code> <code>STM32U083KCU6</code> Ultra-low-power Arm M0+, 32-bit MCU. <code>PMU</code> Power management unit which generaters +3 V and \u00b19 V. <code>X1</code> <code>ECX-1210B</code> 32.768 kHz Crystal."},{"location":"iris-128/iris-128s/quickstart_iris128s/#3-programming-the-adapter-mcu","title":"3. Programming the Adapter MCU","text":"<p>The <code>adapter</code> board has a <code>STM32U083</code> ultra-low-power Arm M0+ 32-bit microcontroller (MCU) which is used to program the state of the switches in the headstage through <code>SPI</code> communication. You can use any tool you want to build the firmware and program the MCU; here we use the <code>STM32Cube</code> tools. You can download all the project documents from our GitHub repository.</p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#building-programming-the-project","title":"Building &amp; Programming the Project","text":"<p>1. Install software &amp; hardware:</p> <ul> <li><code>STM32CubeIDE</code></li> <li><code>STM32CubeProgrammer</code></li> <li><code>STLINK-V3</code> box with cable (for programming the STM32)</li> </ul> <p>2. Download and import the project files:</p> <ul> <li>From <code>GitHub</code>, locate the controller folder.</li> <li>In <code>STM32CubeIDE</code>, go to File \u2192 Import \u2192 Existing Projects into Workspace.</li> <li>Select the controller folder and finish the import.</li> </ul> <p>3. Connect the hardware:</p> <ul> <li>Connect the <code>adapter</code> board to the <code>STLINK-V3</code> through the programming port.</li> <li>Connect the Intan <code>RHD Controller</code> and <code>RHS controller</code> using the Intan Record and Stim cables.</li> <li>Power on the <code>RHD Controller</code> (first) and <code>RHS controller</code>.</li> </ul> <p>4. Open the project in <code>STM32CubeIDE</code>:</p> <ul> <li>Open the <code>controller.ioc</code> file.</li> </ul> <p></p> <p>Figure 7. Screenshoot of the STM32CubeIDE showing the controller.ioc.</p> <p></p> <p>5. Open and edit code:</p> <ul> <li>In the Project Explorer, open <code>main.c</code>.</li> <li>Edit the switch states as described below (these control which electrodes connect to which chip).<ul> <li>Example: To switch electrode RS0 from RHD to RHS, set the corresponding value in the switch matrix to 1 - in the screenshots. Section 2.2 lists the switch positions.</li> </ul> </li> </ul> <p></p> <p>Figure 8. Screenshoot of the STM32CubeIDE showing the main.ioc.</p> <p></p> Switch=0<pre><code>aTxBuffer[0] = 0b00000000; // sw1\naTxBuffer[1] = 0b00000000; // sw2\naTxBuffer[2] = 0b11111111; // sw3\naTxBuffer[3] = 0b11111111; // sw4\naTxBuffer[4] = 0b11111111; // sw5\naTxBuffer[5] = 0b11111111; // sw6\naTxBuffer[6] = 0b00000000; // sw7\naTxBuffer[7] = 0b00000000; // sw8\n</code></pre> Switch=1<pre><code>aTxBuffer[0] = 0b00000000; // sw1\naTxBuffer[1] = 0b00000000; // sw2\naTxBuffer[2] = 0b11111111; // sw3\naTxBuffer[3] = 0b11111111; // sw4\naTxBuffer[4] = 0b10111111; // sw5\naTxBuffer[5] = 0b11111111; // sw6\naTxBuffer[6] = 0b00000000; // sw7\naTxBuffer[7] = 0b00000001; // sw8\n</code></pre> <p>Figure 9. Changing the RS0 switch state from RHD to RHS.</p> <p></p> <p>6. Build and compile:</p> <ul> <li>Click the  icon (\u201cBuild Project\u201d) to compile.</li> <li>Wait for \u201cBuild Finished\u201d to appear in the console.</li> </ul> <p>7. Locate the compiled output:</p> <ul> <li>The compiled firmware file is saved in the project\u2019s <code>Debug</code> folder:<code>C:\\Users\\...\\STM32CubeIDE\\workspace_1.17.0\\controller\\Debug\\controller.elf</code></li> <li>This <code>.elf</code> file can be used directly with <code>STM32CubeProgrammer</code>.</li> </ul> <p>8. Flash the controller using <code>STM32CubeProgrammer</code>:</p> <ul> <li>Open <code>STM32CubeProgrammer</code>.</li> <li>Connect to the board via <code>STLINK-V3</code>.</li> <li>Click <code>Open file</code> and select <code>controller.elf</code> (or <code>controller.bin</code> if generated).</li> <li>Click <code>Start Programming</code>.</li> </ul> <p></p> <p>Figure 10. Screenshoot of the STM32CubeProgrammer showing the main.ioc.</p> <p></p> <p>9. Verify the update:</p> <ul> <li>Restart the Intan RHD and RHS software.</li> <li>Check that the switches have updated correctly (e.g., this can be checked by running the impedance function in Intan RHS controller for that electrode. It should switch from the RHD controller to the RHS controller. Unconnected channels will have MOhm impedances.).</li> </ul> <p></p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#quick-summary","title":"Quick Summary","text":"Step Action Tool 1 Install <code>CubeIDE</code> and <code>CubeProgrammer</code> 2 Import project <code>CubeIDE</code> 3 Connect hardware 4 Open project and connect <code>CubeIDE</code> 5 Edit <code>main.c</code> <code>CubeIDE</code> 6 Build project <code>CubeIDE</code> 7 Locate <code>controller.elf</code> in Debug folder 8 (Optional) Generate <code>controller.bin</code> <code>CubeIDE</code> 9 Flash firmware <code>CubeProgrammer</code> 10 Verify in Intan software"},{"location":"iris-128/iris-128s/quickstart_iris128s/#changing-the-state-of-the-switches","title":"Changing the State of the Switches","text":"<p>You can change the state of each of the switches in the eight octal <code>ADGS5414</code> by updating the values of the constants shown below. Notice that the bit <code>swX[Y]</code> corresponds to the <code>Y</code> switch of component <code>uX</code>, where <code>X</code>,<code>Y</code> \\(\\in \\{1,2,...8 \\}\\) . The value of <code>0</code> indicates the switch is open whereas the <code>1</code> indicates it is closed.</p> Function Actions Recording <code>OPEN</code> the switch to the RHS2116 and <code>CLOSE</code> the one to the RHD2164. Stimulation <code>CLOSE</code> the switch to the RHS2116 and <code>OPEN</code> the one to the RHD2164."},{"location":"iris-128/iris-128s/quickstart_iris128s/#example-code","title":"Example Code","text":"<pre><code>/* Switches states: swX=[7..0] */\n// Default values\naTxBuffer[0] = 0b00000000; // sw1\naTxBuffer[1] = 0b00000000; // sw2\naTxBuffer[2] = 0b11111111; // sw3\naTxBuffer[3] = 0b11111111; // sw4\naTxBuffer[4] = 0b11111111; // sw5\naTxBuffer[5] = 0b11111111; // sw6\naTxBuffer[6] = 0b00000000; // sw7\naTxBuffer[7] = 0b00000000; // sw8\n</code></pre> <p>Warning</p> <p>When configuring a stimulation channel, make sure to <code>OPEN</code> the switch connected to the <code>RHD2164</code>. Failure to do so can cause damage to the <code>RHD2164</code> due to the possibility of higher than expected voltages at its input.</p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#further-development","title":"Further Development","text":"<p>The current use of the MCU is to program the state of the switches in the headstage after the <code>adapter</code> board is powered on. You could further expand the functions of the MCU to adapt the <code>Iris-128s</code> neural interface to your project. For this purpose, the <code>adapter</code> board features a <code>reset button</code>, a <code>32 kHz crystal</code>, and a <code>expansion port</code> with flexible <code>GPIO</code> for easy prototyping and development.</p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#4-hardware-setup","title":"4. Hardware Setup","text":"<p>The figures below show the required hardware setup.</p> <p></p> <p>Figure 11. Hardware setup diagram.</p> <p></p> <p></p> <p>Figure 12. Hardware setup picture.</p> <p></p> <p></p> <p>Figure 13. Iris-128S performing measurements in PBS inside a Faraday cage.</p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#step-1-prepare-for-surgery","title":"Step 1 \u2014 Prepare for Surgery","text":"<ol> <li>Secure the animal in a stereotaxic frame.</li> <li>Mount the 3D-printed headstage holder onto the stereotax.</li> <li>Seat the thin-film electrode connector into the holder.</li> <li>Plug the Iris-128S headstage into the thin-film connector.</li> <li>Fasten the headstage to the holder via mounting holes.</li> </ol>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#step-2-connect-to-adapter","title":"Step 2 \u2014 Connect to Adapter","text":"<ol> <li>Connect the 36-pin custom cable between <code>headstage</code> and <code>adapter</code>.</li> <li>Route this cable outside the Faraday cage.</li> <li>Plug in the 1 RHD interface cable (blue Omnetics) and 1 RHS interface cable (red Omnetics):<ul> <li>S1  RHD Controller</li> <li>S4  RHS Controller</li> </ul> </li> </ol>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#step-3-ground-and-reference","title":"Step 3 \u2014 Ground and Reference","text":"<ul> <li>Connect <code>REF</code> and <code>GND</code> pads using platinum wires soldered into the through-holes on the headstage.  </li> <li>Keep <code>REF</code> and <code>GND</code> unshorted during normal operation.  </li> <li>Optionally, these may be tied together or implemented on the thin-film array.  </li> <li>Ensure the entire setup (animal, cage, supplies) shares a common ground.</li> </ul>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#5-software-setup","title":"5. Software Setup","text":"<ol> <li>Install Intan RHD Recording Controller Software into Computer 1 (see Intan User Guide).</li> <li>Install Intan RHS Recording Controller Software into Computer 2 (see Intan User Guide).</li> <li>Connect the RHD Controller to Computer 1 via USB.</li> <li>Connect the RHS Controller to Computer 2 via USB.</li> <li>Power on the Intan RHD Controller.</li> <li>Power on the Intan RHS Controller.</li> <li>Launch the software in both computers \u2014 channels should automatically appear.  </li> <li>Adjust sampling rate and channel naming as needed.</li> </ol> <p>Figure 14. Two computers running the (left) Intan Recording Controller software and (right) Stimulation/Recording Controller software.</p>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#6-power-up-sequence","title":"6. Power-Up Sequence","text":"<ol> <li>Confirm all mechanical and electrical connections.</li> <li>Turn on RHD Intan Controller. </li> <li>Turn on RHS Intan Controller. </li> <li>Verify communication in the Intan software.</li> </ol>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#7-bench-animal-setup-checklist","title":"7. Bench &amp; Animal Setup Checklist","text":"Stage Procedure Bench Validation Connect planar 128-ch polyimide MEA  verify impedance in PBS (~295 k\u03a9 @ 1 kHz). Grounding Attach platinum wires for <code>REF</code> and <code>GND</code> to headstage pads. Recording Launch Intan software  set sampling rate 30 kSa/s  confirm signal. In Vivo Setup Craniotomy  insert MEA into cortex  connect headstage. Validation Observe LFPs (0.5\u2013100 Hz) and single-unit spikes (~250\u2013500 \u03bcVpp)."},{"location":"iris-128/iris-128s/quickstart_iris128s/#8-performance-summary","title":"8. Performance Summary","text":"Metric Iris 128S Comparison (Intan 32 ch) Noise (Vrms) 3.33 \u03bcV 2.4 \u03bcV Weight 4.47 g 1.4 g Volume 720 mm<sup>3</sup> 576 mm<sup>3</sup> Channels 32 stim / 128 record 32 stim / 32 record Frequency Response 0.5 Hz \u2013 5 kHz (flat midband gain) Similar Impedance (1 kHz, Pt site) ~2.9 \u00d7 10<sup>5</sup> \u03a9 2.4 \u00d7 10<sup>5</sup> \u03a9 Supply \u00b17 V &amp; 3.3 V 3.3 V (single)"},{"location":"iris-128/iris-128s/quickstart_iris128s/#9-stimulation-parameters","title":"9. Stimulation Parameters","text":"<ul> <li>Chip: Intan RHS2116 (D5716)  </li> <li>Current Range: 2.55 \u00b5A \u2013 255 \u00b5A  </li> <li>Step Size: 10 nA \u2013 10 \u00b5A  </li> <li>Supply Range: \u00b13.3 \u2013 10.7 V (max combined 14 V)  </li> <li>Sampling Rates: 1 \u2013 30 kS/s  </li> <li>Test Waveform: Biphasic cathodic-first 4 \u00b5A, 500 \u00b5s pulses, 100 Hz (0.1 mC/cm\u00b2 charge density)</li> </ul>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#10-additional-notes","title":"10. Additional Notes","text":"<ul> <li>The 36-wire custom cable was built on-premise; contact manuel@openic.org for any questions.</li> <li>The design files, schematics, BOMs, and firware are open-source on GitHub (OpenIC / U Oregon).</li> <li>The Iris 128B and 128S share identical PCB stack-up and fabrication parameters:<ul> <li>8-layer (3 mil trace / space, ENIG finish, 1 oz Cu).  </li> </ul> </li> <li>Designed in KiCad, <code>STM32CubeIDE</code>, verified by micro-CT imaging and in vivo rat recordings.</li> <li>For portable or wireless operation, future iterations aim to reduce weight &lt; 3 g.</li> </ul>"},{"location":"iris-128/iris-128s/quickstart_iris128s/#11-reference-setup-recipe","title":"11. Reference Setup Recipe","text":"<ol> <li>Connect all GNDs in the system.</li> <li>Connect electrode array  headstage  adapter  Intan Controllers.</li> <li>Verify REF/GND connections (platinum wire, bone screw, headstage ground, system ground).</li> <li>Power on Intan RHS Controller and RHD Controller and confrim communication with headstage.</li> <li>Update MCU firmware if needed.</li> <li>Begin recording and stimulation tests.</li> </ol>"},{"location":"iris-128/thin-film/","title":"Thin-film","text":"<p>This is the design for the 128 microelectrode array fabricated by the Deku lab to test the Iris 128B and S headstages.</p> <p></p> <p>Fig. 1. Thinfilm used as test platform for headstages.</p>"},{"location":"tutorials/","title":"Tutorials","text":"<ul> <li> Xschem with PCells</li> </ul>"},{"location":"tutorials/xschem-pcell/","title":"Parameterized Cells (P-Cells) with Xschem","text":""},{"location":"tutorials/xschem-pcell/#introduction","title":"Introduction","text":"<p>Xschem allows the use of P-Cells by means of executing a script which is specified as a property of a component in a schematic. Inputs for the script are also declared as properties. To design these scripts, we first build a set of schematic and symbol templates representing each of the building blocks. Then, we use these templates to create specific scripts which output the blocks\u2019 components as a set of text strings analogous to the process of reading the schematic view of a component. Thus, Xschem produces a netlist which includes the parametrized cells, ready for simulation with Ngspice.</p>"},{"location":"tutorials/xschem-pcell/#requirements","title":"Requirements","text":"<ul> <li>WSL-2</li> <li>Docker Desktop</li> <li><code>UNIC-CASS</code> or <code>IIC-JKU</code> Open-Source IC Tools docker container.</li> <li>Python</li> <li>VS Code</li> </ul>"},{"location":"tutorials/xschem-pcell/#example-p-cell-of-inverter","title":"Example: P-Cell of Inverter","text":""},{"location":"tutorials/xschem-pcell/#schematic-symbol-templates","title":"Schematic &amp; Symbol Templates","text":"<p>1. Create a new schematic <code>inv_gen.sch</code> in your design folder. The schematic should look like the figure below.</p> <p></p> <p>2. Create a new symbol <code>inv_gen.sym</code> in your design folder. The symbol should look like the figure below.</p> <p></p> <p>Note</p> <p>It is important that both the <code>sch</code> and <code>sym</code> files have the same name.</p> <p>3. Now, let's take a look at both files in a text editor. We can see that both the schematic and symbol views are text files which can be generated by any script.</p> inv_gen.schinv_gen.sym <pre><code>v {xschem version=3.4.6 file_version=1.2}\nG {}\nK {}\nV {}\nS {}\nE {}\nN -40 0 -40 50 {lab=A}\nN -60 0 -40 0 {lab=A}\nN -40 -50 -40 0 {lab=A}\nN 0 0 0 20 {lab=xxx}\nN 0 0 70 0 {lab=xxx}\nN 0 -20 0 0 {lab=xxx}\nN 0 -100 0 -50 {lab=VDD}\nN -0 50 -0 100 {lab=VSS}\nC {sg13g2_pr/sg13_lv_nmos.sym} -20 50 0 0 {name=M1\nl=0.13u\nw=1u\nng=1\nm=1\nmodel=sg13_lv_nmos\nspiceprefix=X\n}\nC {sg13g2_pr/sg13_lv_pmos.sym} -20 -50 0 0 {name=M2\nl=0.13u\nw=2u\nng=1\nm=1\nmodel=sg13_lv_pmos\nspiceprefix=X\n}\nC {iopin.sym} 0 -100 0 0 {name=p1 lab=VDD}\nC {iopin.sym} 0 100 0 0 {name=p2 lab=VSS}\nC {iopin.sym} -60 0 0 1 {name=p3 lab=A}\nC {iopin.sym} 70 0 0 0 {name=p4 lab=Z}\n</code></pre> <pre><code>v {xschem version=3.4.6 file_version=1.2}\nG {}\nK {type=subcircuit\nformat=\"@name @pinlist @symname\"\ntemplate=\"name=x1\"\n}\nV {}\nS {}\nE {}\nL 4 -20 -20 -20 20 {}\nL 4 -20 -20 20 0 {}\nL 4 -20 20 20 0 {}\nL 4 30 0 50 0 {}\nL 4 -40 0 -20 0 {}\nL 7 0 -20 0 -10 {}\nL 7 0 10 0 20 {}\nB 5 -2.5 -22.5 2.5 -17.5 {name=VDD dir=inout}\nB 5 -42.5 -2.5 -37.5 2.5 {name=A dir=inout}\nB 5 47.5 -2.5 52.5 2.5 {name=Z dir=inout}\nB 5 -2.5 17.5 2.5 22.5 {name=VSS dir=inout}\nA 4 25 0 5 180 360 {}\nT {@symname} 35 4 0 0 0.3 0.3 {}\nT {@name} 35 -32 0 0 0.2 0.2 {}\nT {VDD} 5 -6 2 1 0.2 0.2 {}\nT {A} -35 -14 0 0 0.2 0.2 {}\nT {Z} 45 -14 0 1 0.2 0.2 {}\nT {VSS} 25 6 0 1 0.2 0.2 {}\n</code></pre>"},{"location":"tutorials/xschem-pcell/#python-scripts-outputing-schematic-instances","title":"Python Scripts Outputing Schematic Instances","text":"<p>4. The goal is to create a <code>Python</code> script which output the inverter instances as a set of text strings. With this in mind, we create the file <code>inv_gen.py</code> with the following content:</p> inv_gen.py<pre><code>#!/usr/bin/python3\n\nimport sys\n\n# ****************************************************************\n# Functions\ndef nmos_sg13_lv_nmos(name,w_um,l_um,ng,m,position):\n    libraryname = 'sg13g2_pr'\n    modelname = 'sg13_lv_nmos'\n    print('C {' + libraryname + '/' + modelname + '.sym} ' + str(position[0]) + ' ' + str(position[1]) + ' ' + str(position[2]) + ' ' + str(position[3]) + ' {name=' + name)\n    print('l=' + str(l_um) + 'u')\n    print('w=' + str(w_um) + 'u')\n    print('ng=' + str(ng))\n    print('m=' + str(m))\n    print('model=' + modelname)\n    print('spiceprefix=X')\n    print('}')\n\n\ndef pmos_sg13_lv_pmos(name,w_um,l_um,ng,m,position):\n    libraryname = 'sg13g2_pr'\n    modelname = 'sg13_lv_pmos'\n    print('C {' + libraryname + '/' + modelname + '.sym} ' + str(position[0]) + ' ' + str(position[1]) + ' ' + str(position[2]) + ' ' + str(position[3]) + ' {name=' + name)\n    print('l=' + str(l_um) + 'u')\n    print('w=' + str(w_um) + 'u')\n    print('ng=' + str(ng))\n    print('m=' + str(m))\n    print('model=' + modelname)\n    print('spiceprefix=X')\n    print('}')\n\ndef iopin(name,label,position):\n    pintype = 'iopin'\n    print('C {' + pintype + '.sym} ' + str(position[0]) + ' ' + str(position[1]) + ' ' + str(position[2]) + ' ' + str(position[3]) + ' {name=' + name + ' lab=' + label +'}')\n\n\n# ****************************************************************\n# parsing arguments. These are strings.\nwn_um = float(sys.argv[1])\nwp_um = float(sys.argv[2])\n\n# print schematic\nprint('v {xschem version=3.4.6 file_version=1.2}')\nprint('G {}')\nprint('K {}')\nprint('V {}')\nprint('S {}')\nprint('E {}')\nprint('N -40 0 -40 50 {lab=A}')\nprint('N -60 0 -40 0 {lab=A}')\nprint('N -40 -50 -40 0 {lab=A}')\nprint('N 0 0 0 20 {lab=xxx}')\nprint('N 0 0 70 0 {lab=xxx}')\nprint('N 0 -20 0 0 {lab=xxx}')\nprint('N 0 -100 0 -50 {lab=VDD}')\nprint('N -0 50 -0 100 {lab=VSS}')\nnmos_sg13_lv_nmos('M1',wn_um,0.13,1,1,[-20,50,0,0])\npmos_sg13_lv_pmos('M2',wp_um,0.13,1,1,[-20,-50,0,0])\niopin('p1','VDD',[0,-100,0,0])\niopin('p2','VSS',[0,100,0,0])\niopin('p3','A',[-60,0,0,1])\niopin('p4','Z',[70,0,0,0])\n</code></pre> <p>End of Line characters in Linux and Windows</p> <p>Make sure you create the <code>Python</code> file from your Linux terminal to make sure of the end-of-line character which could affect the execution of the script.</p>"},{"location":"tutorials/xschem-pcell/#setting-up-the-p-cell-in-another-schematic","title":"Setting Up the P-Cell in Another Schematic","text":"<p>5. Let's create a testbench to test our P-Cell <code>inv_gen</code>. Create a new schematic <code>tb_inv_ge.sch</code> to perform a transient simulation. It should look like the figure below.</p> <p></p> <p>6. Select one of the <code>inv_gen</code> instances and open its properties by pressing <code>q</code>. Edit the properties according to the figure below.</p> <p></p> Instance Properties<pre><code>name=x1\nwn_um=1\nwp_um=2\nschematic=\"inv_gen.py(@wn_um\\,@wp_um\\)\"\ntclcommand=\"edit_file [abs_sym_path inv_gen.py]\"\n</code></pre> <p>7. The table below shows each of the properties. Notice how we define the width of each transistor as inputs of the <code>Python</code> script, and pass those variables to the script using <code>@[variable]\\</code>.</p> Property Description wn_um Width of <code>nmos</code> in um. wp_um Width of <code>pmos</code> in um. schematic File name of the <code>Python</code> script with parsed variables. tclcommand <code>TCL</code> command that executes the script."},{"location":"tutorials/xschem-pcell/#when-is-the-script-executed","title":"When is the Script Executed?","text":"<p>8. The <code>Python</code> scripts is executes during:     * <code>Netlist</code> process.     * <code>Descending</code> into the schematic.</p> <p></p> <p></p>"},{"location":"tutorials/xschem-pcell/#simulation-with-two-inverter-sizes","title":"Simulation with Two Inverter Sizes","text":""}]}
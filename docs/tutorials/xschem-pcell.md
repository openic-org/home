# Parameterized Cells (P-Cells) with Xschem

## Introduction

Xschem allows the use of P-Cells by means of executing a script which is specified as a property of a component in a schematic. Inputs for the script are also declared as properties. To design these scripts, we first build a set of schematic and symbol templates representing each of the building blocks. Then, we use these templates to create specific scripts which output the blocksâ€™ components as a set of text strings analogous to the process of reading the schematic view of a component. Thus, Xschem produces a netlist which includes the parametrized cells, ready for simulation with Ngspice.

## Requirements

* WSL-2
* Docker Desktop
* `UNIC-CASS` or `IIC-JKU` Open-Source IC Tools docker container.
* Python
* VS Code

## Example: P-Cell of Inverter

### Schematic & Symbol Templates

1. Create a new schematic `inv_gen.sch` in your design folder. The schematic should look like the figure below.

![alt text](images/inv-gen-sch.png)

2. Create a new symbol `inv_gen.sym` in your design folder. The symbol should look like the figure below.

![alt text](images/inv-gen-sym.png)

!!! note
    It is important that both the `sch` and `sym` files have the same name.

3. Now, let's take a look at both files in a text editor. We can see that both the schematic and symbol views are text files which can be generated by any script.

=== "inv_gen.sch"

    ``` linenums="1"
    v {xschem version=3.4.6 file_version=1.2}
    G {}
    K {}
    V {}
    S {}
    E {}
    N -40 0 -40 50 {lab=A}
    N -60 0 -40 0 {lab=A}
    N -40 -50 -40 0 {lab=A}
    N 0 0 0 20 {lab=xxx}
    N 0 0 70 0 {lab=xxx}
    N 0 -20 0 0 {lab=xxx}
    N 0 -100 0 -50 {lab=VDD}
    N -0 50 -0 100 {lab=VSS}
    C {sg13g2_pr/sg13_lv_nmos.sym} -20 50 0 0 {name=M1
    l=0.13u
    w=1u
    ng=1
    m=1
    model=sg13_lv_nmos
    spiceprefix=X
    }
    C {sg13g2_pr/sg13_lv_pmos.sym} -20 -50 0 0 {name=M2
    l=0.13u
    w=2u
    ng=1
    m=1
    model=sg13_lv_pmos
    spiceprefix=X
    }
    C {iopin.sym} 0 -100 0 0 {name=p1 lab=VDD}
    C {iopin.sym} 0 100 0 0 {name=p2 lab=VSS}
    C {iopin.sym} -60 0 0 1 {name=p3 lab=A}
    C {iopin.sym} 70 0 0 0 {name=p4 lab=Z}
    ```

=== "inv_gen.sym"

    ``` linenums="1"
    v {xschem version=3.4.6 file_version=1.2}
    G {}
    K {type=subcircuit
    format="@name @pinlist @symname"
    template="name=x1"
    }
    V {}
    S {}
    E {}
    L 4 -20 -20 -20 20 {}
    L 4 -20 -20 20 0 {}
    L 4 -20 20 20 0 {}
    L 4 30 0 50 0 {}
    L 4 -40 0 -20 0 {}
    L 7 0 -20 0 -10 {}
    L 7 0 10 0 20 {}
    B 5 -2.5 -22.5 2.5 -17.5 {name=VDD dir=inout}
    B 5 -42.5 -2.5 -37.5 2.5 {name=A dir=inout}
    B 5 47.5 -2.5 52.5 2.5 {name=Z dir=inout}
    B 5 -2.5 17.5 2.5 22.5 {name=VSS dir=inout}
    A 4 25 0 5 180 360 {}
    T {@symname} 35 4 0 0 0.3 0.3 {}
    T {@name} 35 -32 0 0 0.2 0.2 {}
    T {VDD} 5 -6 2 1 0.2 0.2 {}
    T {A} -35 -14 0 0 0.2 0.2 {}
    T {Z} 45 -14 0 1 0.2 0.2 {}
    T {VSS} 25 6 0 1 0.2 0.2 {}
    ```

### Python Scripts Outputing Schematic Instances


### When is the Script Executed?


### Simulation with Two Inverter Sizes